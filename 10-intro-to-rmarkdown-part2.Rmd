---
title: Producing Reports With knitr Part 2
teaching: 30
exercises: 15
questions:
- "How can I integrate software and reports?"
objectives:
- Become more familiar with R code chunks, and understand their purpose, structure and options 
- Demonstrate the use of inline chunks for weaving R outputs into text blocks, for example when discussing the results of some calculations
- Be aware of alternative output formats to which an R Markdown file can be exported
keypoints:
- "Specify chunk options to control formatting."
- "Use `knitr` to convert these documents into PDF and other formats."
source: Rmd
---

```{r, include=FALSE}
source("bin/chunk-options.R")
knitr_fig_path("10-")
```

 How things get compiled

When you press the "Knit" button [`knitr`](http://yihui.name/knitr) processes your R Markdown file to create a plain Markdown document (along with a set of figure files if needed).


When we output a html document the Markdown (and figure documents) are processed by the tool
[`pandoc`](http://pandoc.org/), which converts the Markdown file into an
html file, with the figures embedded.


```{r rmd_to_html_fig, fig.width=8, fig.height=3, fig.align="left", echo=FALSE}
par(mar=rep(0, 4), bty="n", cex=1.5)
plot(0, 0, type="n", xlab="", ylab="", xaxt="n", yaxt="n",
     xlim=c(0, 100), ylim=c(0, 100))
xw <- 10
yh <- 35
xm <- 12
ym <- 50
rect(xm-xw/2, ym-yh/2, xm+xw/2, ym+yh/2, lwd=2)
text(xm, ym, ".Rmd")

xm <- 50
ym <- 80
rect(xm-xw/2, ym-yh/2, xm+xw/2, ym+yh/2, lwd=2)
text(xm, ym, ".md")
xm <- 50; ym <- 25
for(i in c(2, 0, -2))
    rect(xm-xw/2+i, ym-yh/2+i, xm+xw/2+i, ym+yh/2+i, lwd=2,
         border="black", col="white")
text(xm-2, ym-2, "figs/")

xm <- 100-12
ym <- 50
rect(xm-xw/2, ym-yh/2, xm+xw/2, ym+yh/2, lwd=2)
text(xm, ym, ".html")

arrows(22, 50, 38, 50, lwd=2, col="slateblue", len=0.1)
text((22+38)/2, 60, "knitr", col="darkslateblue", cex=1.3)

arrows(62, 50, 78, 50, lwd=2, col="slateblue", len=0.1)
text((62+78)/2, 60, "pandoc", col="darkslateblue", cex=1.3)
```


 Chunk options
 
Firstly we need name our code chunk name. By default all code chunks are blank. ie: 

<pre>
&#96;&#96;&#96;{r}
&#96;&#96;&#96;
</pre>


It is recomended to use a descriptive name ie 'load_data', 'read_libraries' and make sure each chunk has a unique name.  

<pre>
&#96;&#96;&#96;{r load_libraries}
library("dplyr")
library("ggplot2")
&#96;&#96;&#96;
</pre>


You can control how the code is output by changing the code chunk options which follow the title. For example: 

<pre>
&#96;&#96;&#96;{r load_libraries, eval = FALSE, echo = TRUE}
library("dplyr")
library("ggplot2")
&#96;&#96;&#96;
</pre>


There are many different options you can adjust. More details can be found on the Rmarkdown cheatsheet or [here](https://yihui.org/knitr/options/#code-evaluation). 
 
The ones you need to know first are: 

- `cache`: TRUE/FALSE. Do you want the output of the chunk saved so you dont have to run it next time?
- `eval`: Do you want to code to be evaluated?
- `echo`: Do you want to print the code? 
- `include`: Do you want to include the code in the output document? 

Some less used parameters include: 

- `warning=FALSE` and `message=FALSE` to hide any warnings or
  messages produced.
- `fig.height` and `fig.width` to control the size of the figures
  produced (in inches).

> ##Tips: Finding help with chunk options
> You can review all of the `R` chunk options by navigating to
> the "R Markdown Cheat Sheet" under the "Cheatsheets" section 
> of the "Help" field in the toolbar at the top of RStudio.
>



Lets firstly add a name `addup` and set the `eval` parameter to TRUE. 

<pre>
&#96;&#96;&#96;{r addup, eval = TRUE}
1 + 1
&#96;&#96;&#96;
</pre>


```{r adds, eval = TRUE}

1 + 1 

```



Lets now evaluate the code but hide it from the document. We will need to use both the `eval` and `echo` parameters.

<pre>
&#96;&#96;&#96;{r addup, eval = TRUE, echo = FALSE}
1 + 1
&#96;&#96;&#96;
</pre>


```{r addup, eval = TRUE, echo = FALSE}
1 + 1 
```



Often there will be particular options that you'll want to use
repeatedly; for this, you can set _global_ chunk options, like so:

<pre>
&#96;&#96;&#96;{r global_options, echo=FALSE}
knitr::opts_chunk$set(fig.path="Figs/", 
                      message=FALSE, 
                      warning=FALSE,
                      echo=FALSE, 
                      results="hide", 
                      fig.width=11)
&#96;&#96;&#96;
</pre>



 Formatting figures 

We can define the location and size of plots using `fig.height`,`fig.width`
and `fig.align`. We can use `fig.cap` to add a title. 
We can use the **Iris** dataset, which is automatically downloaded with R, to create and format a plot within RMarkdown. 

<pre>
&#96;&#96;&#96;{r pretty_plot, eval = TRUE, echo = FALSE, fig.cap = "Pretty Plot"}
library(ggplot2)

ggplot(data = iris, mapping = aes(x = Sepal.Length, y = Petal.Length)) +
  geom_point()
&#96;&#96;&#96;
</pre>


```{r pretty_plot1, eval = TRUE, echo = TRUE , fig.cap= "Pretty Plot"}
library(ggplot2)

ggplot(data = iris, mapping = aes(x = Sepal.Length, y = Petal.Length)) +
  geom_point()

```


> ## Challenge 3
>
> Generate a plot using the **iris** dataset and ggplot2 package. Now Use chunk options to control the size and alignment of the figure. Hint: you can use the example code above to create the plot. 
> 
> > ## Solution to Challenge 3
> > 
> > <pre>
> > &#96;&#96;&#96;{r pretty_plot, eval = TRUE, echo = FALSE, fig.cap= "Pretty Plot", fig.width = 3, fig.align = 'centre'}
> > ggplot(data = iris, mapping = aes(x = Sepal.Length, y = Petal.Length)) +
  geom_point()
> > &#96;&#96;&#96;
> > </pre>
> > 
> > ```{r pretty_plot, eval = TRUE, echo = FALSE, fig.cap= "Pretty Plot", fig.width = 3, fig.align = 'centre'}
> > ggplot(data = iris, mapping = aes(x = Sepal.Length, y = Petal.Length)) +
  geom_point()
> > ```
> > 
> {: .solution}
{: .challenge}


 Inline R code

To make your document reproducible, you can also use r to populate values within a sentence. This will ensure values are automatically updated when you knit the RMarkdown. We can use <code>&#96;r</code> and <code>&#96;</code> to designate in-line code. 
For example: <code>&#96;r round(some_value, 2)&#96;</code>. The code will be
executed and replaced with the a rounded version of _some_value_ as the result.


For example; 
 <code>&#96;r round(3.141593, 2)&#96;</code> will show as 
 ``` `r round(3.141593, 2)` ```
 
This is useful when incorporating into a sentence: 
 
<code> The ratio of a circle'scircumference to its diameter is &#96;r round(3.141593, 2) &#96;</code>.

This will appear as: 
  
``` The ratio of a circle'scircumference to its diameter is `r round(3.141593, 2)` ```
 
 
We can also do calculations on the fly within our Rmarkdown document. For example we include the number of instructors in this course and populate a sentence. Firstly lets use `length() ` to determine the number of instructors: 

<code>&#96; r length(c("Andy", "Gen", "Sam", "Steph"))&#96; </code>

when we run this in the R console we should get `4`.


Now we can add this as in-line code by using <code>&#96;r</code> and <code>&#96;</code> : 

<code> this course has &#96; r length(c("Andy", "Gen", "Sam", "Steph"))&#96; instructors </code>

The rendered fomat will look like 

``` this course has `r length(c("Sam", "Steph", "Andy", "Gen"))` instructors ```



> ## Challenge 4
>
> Try out a bit of in-line R code using a simple addition eg: 2+2. 
> 
> > ## Solution to Challenge 4
> > 
> > Here's some inline code to determine that 2 + 2 = `` `r
> > 2+2` ``.
> > 
> {: .solution}
{: .challenge}



 Other output options: Word, PDF and more...

We can convert R Markdown to a PDF or a Word document. Click the
little triangle next to the "Knit" button to get a drop-down
menu.

We can also change the YAML option: 

```{r, eval = FALSE}
---
title: "Exploring RMarkdown"
output: html_document
---
```

```{r, eval = FALSE}
---
title: "Exploring RMarkdown"
output: word_document
---
```

```{r, eval = FALSE}
---
title: "Exploring RMarkdown"
output: pdf_document
---
```


A note about Rmd outputs. 

It can be easy to get caught up with how your document looks. I highly recommend avoiding compiling to PDF or word until you really need to. This is also recommended by the author of rmarkdown and knitr, [Yihui Xie](https://yihui.org/en/2018/07/in-html-i-trust/). This means that you can spend time working on generating content, and not trying to get figures to line up correctly and wrestling with LaTex libraries. 



> ## Tips: Creating PDF documents
>
> Markdown documents can be compiled to PDF, however it will likely you will require additional 
> software called LaTex. This software can be tricky to install and it is reccommended to use  
> [tinytex](https://yihui.org/tinytex/) as an alternative. This R package is a lightweight 
> version of LaTex is designed for r users. You can install using the following commands: 
>
>```{r install tinytex, eval = FALSE}
> tinytex::install_tinytex()
>```
> There is lots of information and help available - see [tinytex FQA page](https://yihui.org/tinytex/faq/)
>
{: .callout}



 Resources

* [Knitr in a knutshell tutorial](http://kbroman.org/knitr_knutshell)
* [Dynamic Documents with R and knitr](http://www.amazon.com/exec/obidos/ASIN/1482203537/7210-20) (book)
* [R Markdown documentation](http://rmarkdown.rstudio.com)
* [R Markdown cheat sheet](https://www.rstudio.com/wp-content/uploads/2016/03/rmarkdown-cheatsheet-2.0.pdf)
* [Getting started with R Markdown](https://www.rstudio.com/resources/webinars/getting-started-with-r-markdown/)
* [R Markdown: The Definitive Guide](https://bookdown.org/yihui/rmarkdown/) (book by Rstudio team)
* [Reproducible Reporting](https://www.rstudio.com/resources/webinars/reproducible-reporting/)
* [The Ecosystem of R Markdown](https://www.rstudio.com/resources/webinars/the-ecosystem-of-r-markdown/)
* [Introducing Bookdown](https://www.rstudio.com/resources/webinars/introducing-bookdown/)

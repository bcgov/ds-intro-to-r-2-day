<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 8 Joining Related Data | Micro-Analysis</title>
<meta name="description" content="8.1 Introducing Relational Data In real life, we often have two or more related datasets that share a set of common columns. We would like to combine these two datasets based on their common...">
<meta name="generator" content="bookdown 0.32 with bs4_book()">
<meta property="og:title" content="Chapter 8 Joining Related Data | Micro-Analysis">
<meta property="og:type" content="book">
<meta property="og:url" content="https://bcgov.github.io/ds-intro-to-r-2-day/joining-related-data.html">
<meta property="og:description" content="8.1 Introducing Relational Data In real life, we often have two or more related datasets that share a set of common columns. We would like to combine these two datasets based on their common...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 8 Joining Related Data | Micro-Analysis">
<meta name="twitter:description" content="8.1 Introducing Relational Data In real life, we often have two or more related datasets that share a set of common columns. We would like to combine these two datasets based on their common...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.2/transition.js"></script><script src="libs/bs3compat-0.4.2/tabs.js"></script><script src="libs/bs3compat-0.4.2/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="bs4_style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Micro-Analysis</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Preface</a></li>
<li class="book-part">Fundamentals</li>
<li><a class="" href="introduction-to-r-and-rstudio.html"><span class="header-section-number">1</span> Introduction to R and RStudio</a></li>
<li><a class="" href="seeking-help-in-r.html"><span class="header-section-number">2</span> Seeking Help in R</a></li>
<li><a class="" href="project-management-with-rstudio.html"><span class="header-section-number">3</span> Project Management With RStudio</a></li>
<li><a class="" href="data-structures.html"><span class="header-section-number">4</span> Data Structures</a></li>
<li><a class="" href="manipulating-data-frames-with-dplyr.html"><span class="header-section-number">5</span> Manipulating Data Frames with dplyr</a></li>
<li><a class="" href="creating-publication-quality-graphics-with-ggplot2.html"><span class="header-section-number">6</span> Creating Publication-Quality Graphics with ggplot2</a></li>
<li><a class="" href="create-tidy-data-with-tidyr.html"><span class="header-section-number">7</span> Create Tidy Data with tidyr</a></li>
<li><a class="active" href="joining-related-data.html"><span class="header-section-number">8</span> Joining Related Data</a></li>
<li class="book-part">Beyond the Fundamentals</li>
<li><a class="" href="subsetting-data-frames.html"><span class="header-section-number">9</span> Subsetting Data Frames</a></li>
<li><a class="" href="introduction-to-the-bcdata-package.html"><span class="header-section-number">10</span> Introduction to the bcdata package</a></li>
<li><a class="" href="data-analysis-reports.html"><span class="header-section-number">11</span> Data analysis reports</a></li>
<li><a class="" href="applications-of-r-markdown.html"><span class="header-section-number">12</span> Applications of R Markdown</a></li>
<li><a class="" href="seeking-help-from-others-with-reprex.html"><span class="header-section-number">13</span> Seeking Help from Others with reprex</a></li>
<li class="book-part">Examples and Extra Practice</li>
<li><a class="" href="practice-what-you-have-learned.html"><span class="header-section-number">14</span> Practice what you have Learned</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/bcgov/ds-intro-to-r-2-day">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="joining-related-data" class="section level1" number="8">
<h1>
<span class="header-section-number">8</span> Joining Related Data<a class="anchor" aria-label="anchor" href="#joining-related-data"><i class="fas fa-link"></i></a>
</h1>
<div id="introducing-relational-data" class="section level2" number="8.1">
<h2>
<span class="header-section-number">8.1</span> Introducing Relational Data<a class="anchor" aria-label="anchor" href="#introducing-relational-data"><i class="fas fa-link"></i></a>
</h2>
<p>In real life, we often have two or more related datasets that share a set of common columns. We would like to combine these two datasets based on their common columns, known as <strong>key</strong> or <strong>key variables</strong>.</p>
<p>We may want to change a dataset by adding information from a second dataset.
For example, say we have a dataset containing employee information such as employee ID,
name, job position, hire date, etc., and a second dataset containing the
current and historical wages for each job position. A relevant join – adding a
column of data for each row – may be merging the current wage for each employee
into the employee dataset.</p>
<p>We may also want to choose only a portion of a dataset. For example, say we have a dataset including all students who ever attended a school along with their student ID, years attended, grades for each class, graduation date (if applicable), and so on, and a second dataset which is simply a list of current students. A relevant join
– retaining all columns of data, but for only specific rows – may be a reduction
of the first dataset for only those students currently in attendance, but with all
their information (e.g., grades, etc.).</p>
<p>The first example is that of a <strong>mutating join</strong> - where we change one table
by adding in data from a second table, based on matching through a key variable
that exists in both tables. The second example is that of a <strong>filtering join</strong> -
where we subset one table based on data in a second table, again based on matching
through a key variable.</p>
</div>
<div id="types-of-joins-with-dplyr" class="section level2" number="8.2">
<h2>
<span class="header-section-number">8.2</span> Types of joins with dplyr<a class="anchor" aria-label="anchor" href="#types-of-joins-with-dplyr"><i class="fas fa-link"></i></a>
</h2>
<p>The <code>dplyr</code> package has several functions that allow us to make these joins.
Assume we have tables <em>x</em> and <em>y</em>.</p>
<p>There are four types of <strong>mutating joins</strong>, which add new variables to one
table from matching rows in another:</p>
<ul>
<li><p><strong>inner joins</strong> include all rows in x AND y</p></li>
<li><p><strong>left joins</strong> include all rows in x <em>plus</em> matching rows from y</p></li>
<li><p><strong>full joins</strong> include all rows in x OR y</p></li>
<li><p><strong>right joins</strong> include all rows in y <em>plus</em> matching rows from x</p></li>
</ul>
<p>Note that left, full and right joins are also called <em>outer joins</em>.</p>
<p>There are two types of <strong>filtering joins</strong>, which filter observations from one
table based on whether or not they match an observation in the other table:</p>
<ul>
<li><p><strong>semi joins</strong> return all rows in x that HAVE a match in y</p></li>
<li><p><strong>anti joins</strong> return all rows in x that do NOT HAVE a match in y</p></li>
</ul>
<p>The syntax for dplyr joins is simple: <code>xxx_join(x, y, by = "key_variable")</code>.</p>
</div>
<div id="introducing-the-nycflights13-data" class="section level2" number="8.3">
<h2>
<span class="header-section-number">8.3</span> Introducing the nycflights13 data<a class="anchor" aria-label="anchor" href="#introducing-the-nycflights13-data"><i class="fas fa-link"></i></a>
</h2>
<p>In prior lessons, you have seen datasets such as the gapminder and cat data.
Now let’s use a different dataset, from the <code>nycflights13</code> package<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;Wickham H (2022). nycflights13: Flights that Departed NYC in 2013. R package version 1.0.2, &lt;a href="https://github.com/hadley/nycflights13" class="uri"&gt;https://github.com/hadley/nycflights13&lt;/a&gt;.&lt;/p&gt;'><sup>1</sup></a>,
to explore relational data.</p>
<p>This package contains information about all flights that departed from
New York City (e.g., EWR, JFK and LGA) to destinations in 2013. To help
understand what causes delays, it also includes a number of other useful datasets:</p>
<ul>
<li>weather: hourly meteorological data for each airport</li>
<li>planes: construction information about each plane</li>
<li>airports: airport names and locations</li>
<li>airlines: translation between two letter carrier codes and names</li>
</ul>
<p>This diagram shows the relationships among the five datasets:</p>
<div class="figure">
<img src="fig/13-joins-fig1.png" alt=""><p class="caption">Source: <a href="https://r4ds.had.co.nz/relational-data.html" class="uri">https://r4ds.had.co.nz/relational-data.html</a></p>
</div>
<p>The key <strong>variables</strong> between flights and the <em>other datasets</em> are:</p>
<ul>
<li>flights dataset &lt;- <strong>origin</strong> and <strong>dest</strong> both = <strong>faa</strong> -&gt; <em>airports</em> dataset</li>
<li>flights dataset &lt;- <strong>tailnum</strong> -&gt; <em>planes</em> dataset</li>
<li>flights dataset &lt;- <strong>origin</strong>, <strong>year</strong>, <strong>month</strong>, <strong>day</strong>, and <strong>hour</strong> -&gt; <em>weather</em> dataset</li>
<li>flights dataset &lt;- <strong>carrier</strong> -&gt; <em>airlines</em> dataset</li>
</ul>
</div>
<div id="getting-started-2" class="section level2" number="8.4">
<h2>
<span class="header-section-number">8.4</span> Getting started<a class="anchor" aria-label="anchor" href="#getting-started-2"><i class="fas fa-link"></i></a>
</h2>
<p>First, install the packages if you haven’t already done so (you probably
installed dplyr in a previous lesson):</p>
<div class="sourceCode" id="cb391"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"dplyr"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"nycflights13"</span><span class="op">)</span></span></code></pre></div>
<p>Then, load the packages:</p>
<div class="sourceCode" id="cb392"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hadley/nycflights13">nycflights13</a></span><span class="op">)</span></span></code></pre></div>
<p>Let’s take a peek at the main <code>nycflights13</code> dataset, “flights”:</p>
<div class="sourceCode" id="cb393"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">flights</span></span></code></pre></div>
<pre><code># A tibble: 336,776 × 19
    year month   day dep_time sched_de…¹ dep_d…² arr_t…³ sched…⁴ arr_d…⁵ carrier
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;      &lt;int&gt;   &lt;dbl&gt;   &lt;int&gt;   &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;  
 1  2013     1     1      517        515       2     830     819      11 UA     
 2  2013     1     1      533        529       4     850     830      20 UA     
 3  2013     1     1      542        540       2     923     850      33 AA     
 4  2013     1     1      544        545      -1    1004    1022     -18 B6     
 5  2013     1     1      554        600      -6     812     837     -25 DL     
 6  2013     1     1      554        558      -4     740     728      12 UA     
 7  2013     1     1      555        600      -5     913     854      19 B6     
 8  2013     1     1      557        600      -3     709     723     -14 EV     
 9  2013     1     1      557        600      -3     838     846      -8 B6     
10  2013     1     1      558        600      -2     753     745       8 AA     
# … with 336,766 more rows, 9 more variables: flight &lt;int&gt;, tailnum &lt;chr&gt;,
#   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
#   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, and abbreviated variable names
#   ¹​sched_dep_time, ²​dep_delay, ³​arr_time, ⁴​sched_arr_time, ⁵​arr_delay</code></pre>
<p>And get some more information about the flights dataset:</p>
<div class="sourceCode" id="cb395"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="va">flights</span></span></code></pre></div>
<p>This tells us that the airline name, as opposed to a two-letter carrier abbreviation,
can be found in the <code>airlines</code> dataset, and that the <code>airports</code> dataset gives
more information on the flight destinations.</p>
<p>First, we will drop some variables from flights to make our work more evident.</p>
<div class="sourceCode" id="cb396"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">flights_mini</span> <span class="op">&lt;-</span> <span class="va">flights</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">year</span><span class="op">:</span><span class="va">day</span>, <span class="va">dep_delay</span>, <span class="va">carrier</span><span class="op">:</span><span class="va">dest</span><span class="op">)</span></span>
<span><span class="va">flights_mini</span></span></code></pre></div>
<pre><code># A tibble: 336,776 × 9
    year month   day dep_delay carrier flight tailnum origin dest 
   &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;
 1  2013     1     1         2 UA        1545 N14228  EWR    IAH  
 2  2013     1     1         4 UA        1714 N24211  LGA    IAH  
 3  2013     1     1         2 AA        1141 N619AA  JFK    MIA  
 4  2013     1     1        -1 B6         725 N804JB  JFK    BQN  
 5  2013     1     1        -6 DL         461 N668DN  LGA    ATL  
 6  2013     1     1        -4 UA        1696 N39463  EWR    ORD  
 7  2013     1     1        -5 B6         507 N516JB  EWR    FLL  
 8  2013     1     1        -3 EV        5708 N829AS  LGA    IAD  
 9  2013     1     1        -3 B6          79 N593JB  JFK    MCO  
10  2013     1     1        -2 AA         301 N3ALAA  LGA    ORD  
# … with 336,766 more rows</code></pre>
<div id="data-analysis-questions" class="section level3" number="8.4.1">
<h3>
<span class="header-section-number">8.4.1</span> Data analysis questions<a class="anchor" aria-label="anchor" href="#data-analysis-questions"><i class="fas fa-link"></i></a>
</h3>
<p>How would we answer the following questions:</p>
<ul>
<li><p>what is the total number of flights per airline, but with
the airline name showing instead of the carrier abbreviation?</p></li>
<li><p>how many flights occurred when the temperature fell below freezing?</p></li>
<li><p>are older planes more likely to have a delayed arrival?</p></li>
</ul>
<p>Answering questions such as these requires us to join datasets.</p>
</div>
</div>
<div id="using-left_join" class="section level2" number="8.5">
<h2>
<span class="header-section-number">8.5</span> Using <strong>left_join()</strong><a class="anchor" aria-label="anchor" href="#using-left_join"><i class="fas fa-link"></i></a>
</h2>
<p>The syntax for dplyr joins is: <code>xxx_join(x, y, by = "key_variable")</code>.</p>
<p>To answer the first question (i.e., number of flights per airline), we need
to join the flights and airlines datasets. We want a <strong>left join</strong> because we
want to add the airline names from airlines (as our second table) to flights
(our first table). From above, we know that the flights dataset has a variable
called ‘carrier’, and that that same variable is in the airlines dataset – this
is our key (or “by” variable).</p>
<div class="sourceCode" id="cb398"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">flights_mini</span>, y <span class="op">=</span> <span class="va">airlines</span>, by <span class="op">=</span> <span class="st">"carrier"</span><span class="op">)</span></span></code></pre></div>
<pre><code># A tibble: 336,776 × 10
    year month   day dep_delay carrier flight tailnum origin dest  name         
   &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;        
 1  2013     1     1         2 UA        1545 N14228  EWR    IAH   United Air L…
 2  2013     1     1         4 UA        1714 N24211  LGA    IAH   United Air L…
 3  2013     1     1         2 AA        1141 N619AA  JFK    MIA   American Air…
 4  2013     1     1        -1 B6         725 N804JB  JFK    BQN   JetBlue Airw…
 5  2013     1     1        -6 DL         461 N668DN  LGA    ATL   Delta Air Li…
 6  2013     1     1        -4 UA        1696 N39463  EWR    ORD   United Air L…
 7  2013     1     1        -5 B6         507 N516JB  EWR    FLL   JetBlue Airw…
 8  2013     1     1        -3 EV        5708 N829AS  LGA    IAD   ExpressJet A…
 9  2013     1     1        -3 B6          79 N593JB  JFK    MCO   JetBlue Airw…
10  2013     1     1        -2 AA         301 N3ALAA  LGA    ORD   American Air…
# … with 336,766 more rows</code></pre>
<p>We can see that the number of rows has stayed the same: 366,776, but that we
have one new column (at the end) called “name”.</p>
<p>Note that we could have instead used the pipe operator after summoning ‘flights_mini’.</p>
<div class="sourceCode" id="cb400"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">flights_mini</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">airlines</span>, by <span class="op">=</span> <span class="st">"carrier"</span><span class="op">)</span></span></code></pre></div>
<pre><code># A tibble: 336,776 × 10
    year month   day dep_delay carrier flight tailnum origin dest  name         
   &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;        
 1  2013     1     1         2 UA        1545 N14228  EWR    IAH   United Air L…
 2  2013     1     1         4 UA        1714 N24211  LGA    IAH   United Air L…
 3  2013     1     1         2 AA        1141 N619AA  JFK    MIA   American Air…
 4  2013     1     1        -1 B6         725 N804JB  JFK    BQN   JetBlue Airw…
 5  2013     1     1        -6 DL         461 N668DN  LGA    ATL   Delta Air Li…
 6  2013     1     1        -4 UA        1696 N39463  EWR    ORD   United Air L…
 7  2013     1     1        -5 B6         507 N516JB  EWR    FLL   JetBlue Airw…
 8  2013     1     1        -3 EV        5708 N829AS  LGA    IAD   ExpressJet A…
 9  2013     1     1        -3 B6          79 N593JB  JFK    MCO   JetBlue Airw…
10  2013     1     1        -2 AA         301 N3ALAA  LGA    ORD   American Air…
# … with 336,766 more rows</code></pre>
<p>Now, let’s wrangle to get the total counts, by grouping by either carrier or the
new “name” variable brought in from the airlines dataset. Note that we can also
drop the argument names (e.g., no “y” in “y = airlines”). I tend to keep the
“by” argument name in to keep my code a bit more clear.</p>
<div class="sourceCode" id="cb402"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">flights_mini</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">airlines</span>, by <span class="op">=</span> <span class="st">"carrier"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">name</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>total_flights <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code># A tibble: 16 × 2
   name                        total_flights
   &lt;chr&gt;                               &lt;int&gt;
 1 AirTran Airways Corporation          3260
 2 Alaska Airlines Inc.                  714
 3 American Airlines Inc.              32729
 4 Delta Air Lines Inc.                48110
 5 Endeavor Air Inc.                   18460
 6 Envoy Air                           26397
 7 ExpressJet Airlines Inc.            54173
 8 Frontier Airlines Inc.                685
 9 Hawaiian Airlines Inc.                342
10 JetBlue Airways                     54635
11 Mesa Airlines Inc.                    601
12 SkyWest Airlines Inc.                  32
13 Southwest Airlines Co.              12275
14 United Air Lines Inc.               58665
15 US Airways Inc.                     20536
16 Virgin America                       5162</code></pre>
<p>We can also rename variables within our join call. Let’s rename “name” to
“airline” (and sort descending by number of flights).</p>
<div class="sourceCode" id="cb404"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">flights_mini</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">airlines</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">carrier</span>, Airline <span class="op">=</span> <span class="va">name</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"carrier"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co">## make sure you use the new variable name</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">Airline</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>`Total Flights` <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">`Total Flights`</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code># A tibble: 16 × 2
   Airline                     `Total Flights`
   &lt;chr&gt;                                 &lt;int&gt;
 1 United Air Lines Inc.                 58665
 2 JetBlue Airways                       54635
 3 ExpressJet Airlines Inc.              54173
 4 Delta Air Lines Inc.                  48110
 5 American Airlines Inc.                32729
 6 Envoy Air                             26397
 7 US Airways Inc.                       20536
 8 Endeavor Air Inc.                     18460
 9 Southwest Airlines Co.                12275
10 Virgin America                         5162
11 AirTran Airways Corporation            3260
12 Alaska Airlines Inc.                    714
13 Frontier Airlines Inc.                  685
14 Mesa Airlines Inc.                      601
15 Hawaiian Airlines Inc.                  342
16 SkyWest Airlines Inc.                    32</code></pre>
<div id="challenge-1-2-minutes" class="section level3" number="8.5.1">
<h3>
<span class="header-section-number">8.5.1</span> Challenge 1 (2 minutes)<a class="anchor" aria-label="anchor" href="#challenge-1-2-minutes"><i class="fas fa-link"></i></a>
</h3>
<blockquote>
<p>How would you add each plane’s manufacture year (rename it “manufacture_year”)
to the flights dataset?</p>
<details><summary>
Solution to challenge 1
</summary><p><br></p>
<div class="sourceCode" id="cb406"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">flights_mini</span>, <span class="va">planes</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">tailnum</span>, manufacture_year <span class="op">=</span> <span class="va">year</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"tailnum"</span><span class="op">)</span></span></code></pre></div>
<pre><code># A tibble: 336,776 × 10
   year month   day dep_delay carrier flight tailnum origin dest  manufacture…¹
  &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;         &lt;int&gt;
1  2013     1     1         2 UA        1545 N14228  EWR    IAH            1999
2  2013     1     1         4 UA        1714 N24211  LGA    IAH            1998
3  2013     1     1         2 AA        1141 N619AA  JFK    MIA            1990
4  2013     1     1        -1 B6         725 N804JB  JFK    BQN            2012
5  2013     1     1        -6 DL         461 N668DN  LGA    ATL            1991
6  2013     1     1        -4 UA        1696 N39463  EWR    ORD            2012
7  2013     1     1        -5 B6         507 N516JB  EWR    FLL            2000
8  2013     1     1        -3 EV        5708 N829AS  LGA    IAD            1998
9  2013     1     1        -3 B6          79 N593JB  JFK    MCO            2004
10  2013     1     1        -2 AA         301 N3ALAA  LGA    ORD              NA
# … with 336,766 more rows, and abbreviated variable name ¹​manufacture_year</code></pre>
<div class="sourceCode" id="cb408"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## same as this:</span></span>
<span><span class="va">flights_mini</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">planes</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">tailnum</span>, manufacture_year <span class="op">=</span> <span class="va">year</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"tailnum"</span><span class="op">)</span></span></code></pre></div>
<pre><code># A tibble: 336,776 × 10
   year month   day dep_delay carrier flight tailnum origin dest  manufacture…¹
  &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;         &lt;int&gt;
1  2013     1     1         2 UA        1545 N14228  EWR    IAH            1999
2  2013     1     1         4 UA        1714 N24211  LGA    IAH            1998
3  2013     1     1         2 AA        1141 N619AA  JFK    MIA            1990
4  2013     1     1        -1 B6         725 N804JB  JFK    BQN            2012
5  2013     1     1        -6 DL         461 N668DN  LGA    ATL            1991
6  2013     1     1        -4 UA        1696 N39463  EWR    ORD            2012
7  2013     1     1        -5 B6         507 N516JB  EWR    FLL            2000
8  2013     1     1        -3 EV        5708 N829AS  LGA    IAD            1998
9  2013     1     1        -3 B6          79 N593JB  JFK    MCO            2004
10  2013     1     1        -2 AA         301 N3ALAA  LGA    ORD              NA
# … with 336,766 more rows, and abbreviated variable name ¹​manufacture_year</code></pre>
</details>
</blockquote>
<p>One thing we haven’t specifically noted is that mutating joins will bring in all
variables from the matching dataset. You’ll see from the solution above that we
can change that behaviour by using <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> and listing only those variables we
want to join in (don’t forget the key variable!).</p>
</div>
</div>
<div id="modifying-the-by-argument" class="section level2" number="8.6">
<h2>
<span class="header-section-number">8.6</span> Modifying the <code>by</code> argument<a class="anchor" aria-label="anchor" href="#modifying-the-by-argument"><i class="fas fa-link"></i></a>
</h2>
<div id="excluding-the-by-argument" class="section level3" number="8.6.1">
<h3>
<span class="header-section-number">8.6.1</span> Excluding the <code>by</code> argument<a class="anchor" aria-label="anchor" href="#excluding-the-by-argument"><i class="fas fa-link"></i></a>
</h3>
<p>We can modify the “by” argument a few ways. See what happens if we don’t
specify a <code>by</code> variable.</p>
<div class="sourceCode" id="cb410"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## joining without specifying a `by` variable</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">flights_mini</span>, <span class="va">airlines</span><span class="op">)</span></span></code></pre></div>
<pre><code>Joining, by = "carrier"</code></pre>
<pre><code># A tibble: 336,776 × 10
    year month   day dep_delay carrier flight tailnum origin dest  name         
   &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;        
 1  2013     1     1         2 UA        1545 N14228  EWR    IAH   United Air L…
 2  2013     1     1         4 UA        1714 N24211  LGA    IAH   United Air L…
 3  2013     1     1         2 AA        1141 N619AA  JFK    MIA   American Air…
 4  2013     1     1        -1 B6         725 N804JB  JFK    BQN   JetBlue Airw…
 5  2013     1     1        -6 DL         461 N668DN  LGA    ATL   Delta Air Li…
 6  2013     1     1        -4 UA        1696 N39463  EWR    ORD   United Air L…
 7  2013     1     1        -5 B6         507 N516JB  EWR    FLL   JetBlue Airw…
 8  2013     1     1        -3 EV        5708 N829AS  LGA    IAD   ExpressJet A…
 9  2013     1     1        -3 B6          79 N593JB  JFK    MCO   JetBlue Airw…
10  2013     1     1        -2 AA         301 N3ALAA  LGA    ORD   American Air…
# … with 336,766 more rows</code></pre>
<p>R will match by any variable with the same name in both datasets. Be careful -
this might not be what you want!</p>
<div class="sourceCode" id="cb413"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">flights_mini</span>, <span class="va">planes</span><span class="op">)</span></span></code></pre></div>
<pre><code>Joining, by = c("year", "tailnum")</code></pre>
<pre><code># A tibble: 336,776 × 16
    year month   day dep_delay carrier flight tailnum origin dest  type  manuf…¹
   &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;  
 1  2013     1     1         2 UA        1545 N14228  EWR    IAH   &lt;NA&gt;  &lt;NA&gt;   
 2  2013     1     1         4 UA        1714 N24211  LGA    IAH   &lt;NA&gt;  &lt;NA&gt;   
 3  2013     1     1         2 AA        1141 N619AA  JFK    MIA   &lt;NA&gt;  &lt;NA&gt;   
 4  2013     1     1        -1 B6         725 N804JB  JFK    BQN   &lt;NA&gt;  &lt;NA&gt;   
 5  2013     1     1        -6 DL         461 N668DN  LGA    ATL   &lt;NA&gt;  &lt;NA&gt;   
 6  2013     1     1        -4 UA        1696 N39463  EWR    ORD   &lt;NA&gt;  &lt;NA&gt;   
 7  2013     1     1        -5 B6         507 N516JB  EWR    FLL   &lt;NA&gt;  &lt;NA&gt;   
 8  2013     1     1        -3 EV        5708 N829AS  LGA    IAD   &lt;NA&gt;  &lt;NA&gt;   
 9  2013     1     1        -3 B6          79 N593JB  JFK    MCO   &lt;NA&gt;  &lt;NA&gt;   
10  2013     1     1        -2 AA         301 N3ALAA  LGA    ORD   &lt;NA&gt;  &lt;NA&gt;   
# … with 336,766 more rows, 5 more variables: model &lt;chr&gt;, engines &lt;int&gt;,
#   seats &lt;int&gt;, speed &lt;int&gt;, engine &lt;chr&gt;, and abbreviated variable name
#   ¹​manufacturer</code></pre>
<p>The variable “year” exists in both flights_mini and planes, but means different
things. When not specifying the key, R assumed you wanted to join by “year” as
well, which resulted in a lot of NAs!</p>
</div>
<div id="joining-on-multiple-keys" class="section level3" number="8.6.2">
<h3>
<span class="header-section-number">8.6.2</span> Joining on multiple keys<a class="anchor" aria-label="anchor" href="#joining-on-multiple-keys"><i class="fas fa-link"></i></a>
</h3>
<p>You may have noticed earlier that we can join by more than one variable. To do
so, simply use <code>c("variable1", "variable2", "etc")</code> for your keys. Notice that
year, month, day, and origin are in both the flights_mini and weather datasets.</p>
<div class="sourceCode" id="cb416"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">flights_mini</span>, <span class="va">weather</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"year"</span>, <span class="st">"month"</span>, <span class="st">"day"</span>, <span class="st">"origin"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code># A tibble: 8,036,575 × 20
    year month   day dep_delay carrier flight tailnum origin dest   hour  temp
   &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt; &lt;int&gt; &lt;dbl&gt;
 1  2013     1     1         2 UA        1545 N14228  EWR    IAH       1  39.0
 2  2013     1     1         2 UA        1545 N14228  EWR    IAH       2  39.0
 3  2013     1     1         2 UA        1545 N14228  EWR    IAH       3  39.0
 4  2013     1     1         2 UA        1545 N14228  EWR    IAH       4  39.9
 5  2013     1     1         2 UA        1545 N14228  EWR    IAH       5  39.0
 6  2013     1     1         2 UA        1545 N14228  EWR    IAH       6  37.9
 7  2013     1     1         2 UA        1545 N14228  EWR    IAH       7  39.0
 8  2013     1     1         2 UA        1545 N14228  EWR    IAH       8  39.9
 9  2013     1     1         2 UA        1545 N14228  EWR    IAH       9  39.9
10  2013     1     1         2 UA        1545 N14228  EWR    IAH      10  41  
# … with 8,036,565 more rows, and 9 more variables: dewp &lt;dbl&gt;, humid &lt;dbl&gt;,
#   wind_dir &lt;dbl&gt;, wind_speed &lt;dbl&gt;, wind_gust &lt;dbl&gt;, precip &lt;dbl&gt;,
#   pressure &lt;dbl&gt;, visib &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>You’ll see that we now have over 8 million rows. This is because the “hour”
variable in weather matched many times for each year X month X day X origin
combination, resulting in repeat of information from flights_mini.</p>
<p>What happens if you didn’t know that “year” was in both datasets?</p>
<div class="sourceCode" id="cb418"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">flights_mini</span>, <span class="va">weather</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"month"</span>, <span class="st">"day"</span>, <span class="st">"origin"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code># A tibble: 8,036,575 × 21
   year.x month   day dep_delay carrier flight tailnum origin dest  year.y  hour
    &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;  &lt;int&gt; &lt;int&gt;
 1   2013     1     1         2 UA        1545 N14228  EWR    IAH     2013     1
 2   2013     1     1         2 UA        1545 N14228  EWR    IAH     2013     2
 3   2013     1     1         2 UA        1545 N14228  EWR    IAH     2013     3
 4   2013     1     1         2 UA        1545 N14228  EWR    IAH     2013     4
 5   2013     1     1         2 UA        1545 N14228  EWR    IAH     2013     5
 6   2013     1     1         2 UA        1545 N14228  EWR    IAH     2013     6
 7   2013     1     1         2 UA        1545 N14228  EWR    IAH     2013     7
 8   2013     1     1         2 UA        1545 N14228  EWR    IAH     2013     8
 9   2013     1     1         2 UA        1545 N14228  EWR    IAH     2013     9
10   2013     1     1         2 UA        1545 N14228  EWR    IAH     2013    10
# … with 8,036,565 more rows, and 10 more variables: temp &lt;dbl&gt;, dewp &lt;dbl&gt;,
#   humid &lt;dbl&gt;, wind_dir &lt;dbl&gt;, wind_speed &lt;dbl&gt;, wind_gust &lt;dbl&gt;,
#   precip &lt;dbl&gt;, pressure &lt;dbl&gt;, visib &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>The “year” variable from flights_mini has been renamed “year.x”, and “year”
from “weather” has been renamed “year.y”. (Whenever this happens, variables
ending in “.x” come from the first table, while those ending in “.y” come from
the other table.)</p>
</div>
<div id="key-variables-with-different-names" class="section level3" number="8.6.3">
<h3>
<span class="header-section-number">8.6.3</span> Key variables with different names<a class="anchor" aria-label="anchor" href="#key-variables-with-different-names"><i class="fas fa-link"></i></a>
</h3>
<p>We can also match on a key that has a different name in the related tables
(although its values are the same). The variable “faa” in airports is equivalent
to flights_mini’s “dest” variable. Here are three ways of getting the same result.</p>
<div class="sourceCode" id="cb420"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## matching key name in the `by`</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">flights_mini</span>, <span class="va">airports</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"dest"</span> <span class="op">=</span> <span class="st">"faa"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code># A tibble: 336,776 × 16
    year month   day dep_delay carrier flight tailnum origin dest  name      lat
   &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;dbl&gt;
 1  2013     1     1         2 UA        1545 N14228  EWR    IAH   George…  30.0
 2  2013     1     1         4 UA        1714 N24211  LGA    IAH   George…  30.0
 3  2013     1     1         2 AA        1141 N619AA  JFK    MIA   Miami …  25.8
 4  2013     1     1        -1 B6         725 N804JB  JFK    BQN   &lt;NA&gt;     NA  
 5  2013     1     1        -6 DL         461 N668DN  LGA    ATL   Hartsf…  33.6
 6  2013     1     1        -4 UA        1696 N39463  EWR    ORD   Chicag…  42.0
 7  2013     1     1        -5 B6         507 N516JB  EWR    FLL   Fort L…  26.1
 8  2013     1     1        -3 EV        5708 N829AS  LGA    IAD   Washin…  38.9
 9  2013     1     1        -3 B6          79 N593JB  JFK    MCO   Orland…  28.4
10  2013     1     1        -2 AA         301 N3ALAA  LGA    ORD   Chicag…  42.0
# … with 336,766 more rows, and 5 more variables: lon &lt;dbl&gt;, alt &lt;dbl&gt;,
#   tz &lt;dbl&gt;, dst &lt;chr&gt;, tzone &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb422"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## renaming key in a select</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">flights_mini</span>, <span class="va">airports</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>dest <span class="op">=</span> <span class="va">faa</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"dest"</span><span class="op">)</span></span></code></pre></div>
<pre><code># A tibble: 336,776 × 16
    year month   day dep_delay carrier flight tailnum origin dest  name      lat
   &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;dbl&gt;
 1  2013     1     1         2 UA        1545 N14228  EWR    IAH   George…  30.0
 2  2013     1     1         4 UA        1714 N24211  LGA    IAH   George…  30.0
 3  2013     1     1         2 AA        1141 N619AA  JFK    MIA   Miami …  25.8
 4  2013     1     1        -1 B6         725 N804JB  JFK    BQN   &lt;NA&gt;     NA  
 5  2013     1     1        -6 DL         461 N668DN  LGA    ATL   Hartsf…  33.6
 6  2013     1     1        -4 UA        1696 N39463  EWR    ORD   Chicag…  42.0
 7  2013     1     1        -5 B6         507 N516JB  EWR    FLL   Fort L…  26.1
 8  2013     1     1        -3 EV        5708 N829AS  LGA    IAD   Washin…  38.9
 9  2013     1     1        -3 B6          79 N593JB  JFK    MCO   Orland…  28.4
10  2013     1     1        -2 AA         301 N3ALAA  LGA    ORD   Chicag…  42.0
# … with 336,766 more rows, and 5 more variables: lon &lt;dbl&gt;, alt &lt;dbl&gt;,
#   tz &lt;dbl&gt;, dst &lt;chr&gt;, tzone &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb424"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## syntax with pipe operator</span></span>
<span><span class="va">flights_mini</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">airports</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>dest <span class="op">=</span> <span class="va">faa</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>Joining, by = "dest"</code></pre>
<pre><code># A tibble: 336,776 × 16
    year month   day dep_delay carrier flight tailnum origin dest  name      lat
   &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;dbl&gt;
 1  2013     1     1         2 UA        1545 N14228  EWR    IAH   George…  30.0
 2  2013     1     1         4 UA        1714 N24211  LGA    IAH   George…  30.0
 3  2013     1     1         2 AA        1141 N619AA  JFK    MIA   Miami …  25.8
 4  2013     1     1        -1 B6         725 N804JB  JFK    BQN   &lt;NA&gt;     NA  
 5  2013     1     1        -6 DL         461 N668DN  LGA    ATL   Hartsf…  33.6
 6  2013     1     1        -4 UA        1696 N39463  EWR    ORD   Chicag…  42.0
 7  2013     1     1        -5 B6         507 N516JB  EWR    FLL   Fort L…  26.1
 8  2013     1     1        -3 EV        5708 N829AS  LGA    IAD   Washin…  38.9
 9  2013     1     1        -3 B6          79 N593JB  JFK    MCO   Orland…  28.4
10  2013     1     1        -2 AA         301 N3ALAA  LGA    ORD   Chicag…  42.0
# … with 336,766 more rows, and 5 more variables: lon &lt;dbl&gt;, alt &lt;dbl&gt;,
#   tz &lt;dbl&gt;, dst &lt;chr&gt;, tzone &lt;chr&gt;</code></pre>
</div>
</div>
<div id="other-mutating-joins" class="section level2" number="8.7">
<h2>
<span class="header-section-number">8.7</span> Other mutating joins<a class="anchor" aria-label="anchor" href="#other-mutating-joins"><i class="fas fa-link"></i></a>
</h2>
<p>We have only been working with left joins so far. The idea is exactly the same
for full, right and inner joins.</p>
<ul>
<li><p><code>full_join(x, y, by)</code> - everything!</p></li>
<li><p><code>right_join(x, y, by)</code> - equivalent to left_join(y, x, by), but the columns and rows will be ordered differently</p></li>
<li><p><code>inner_join(x, y, by)</code> - only rows found in both</p></li>
</ul>
<p>The difference is what you end up with.</p>
<p>Let’s create two small datasets to compare the results of the above types of joins.
Both tables have an ID column – this is our key – and one other variable.</p>
<div class="sourceCode" id="cb427"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tbl1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>ID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ID_1"</span>, <span class="st">"ID_2"</span>, <span class="st">"ID_3"</span>, <span class="st">"ID_4"</span>, <span class="st">"ID_5"</span>, <span class="st">"ID_6"</span><span class="op">)</span>,</span>
<span>              activity1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"cycling"</span>, <span class="st">"basketball"</span>, <span class="st">"kung fu"</span>, <span class="st">"reading"</span>, <span class="st">"running"</span>, <span class="st">"skating"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">tbl2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>ID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ID_2"</span>, <span class="st">"ID_4"</span>, <span class="st">"ID_6"</span>, <span class="st">"ID_8"</span><span class="op">)</span>, </span>
<span>              place2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"outside court"</span>, <span class="st">"library"</span>, <span class="st">"rec center"</span>, <span class="st">"pool"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tbl1</span></span></code></pre></div>
<pre><code># A tibble: 6 × 2
  ID    activity1 
  &lt;chr&gt; &lt;chr&gt;     
1 ID_1  cycling   
2 ID_2  basketball
3 ID_3  kung fu   
4 ID_4  reading   
5 ID_5  running   
6 ID_6  skating   </code></pre>
<div class="sourceCode" id="cb429"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tbl2</span></span></code></pre></div>
<pre><code># A tibble: 4 × 2
  ID    place2       
  &lt;chr&gt; &lt;chr&gt;        
1 ID_2  outside court
2 ID_4  library      
3 ID_6  rec center   
4 ID_8  pool         </code></pre>
<div class="sourceCode" id="cb431"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">tbl1</span>, <span class="va">tbl2</span>, by <span class="op">=</span> <span class="st">"ID"</span><span class="op">)</span></span></code></pre></div>
<pre><code># A tibble: 6 × 3
  ID    activity1  place2       
  &lt;chr&gt; &lt;chr&gt;      &lt;chr&gt;        
1 ID_1  cycling    &lt;NA&gt;         
2 ID_2  basketball outside court
3 ID_3  kung fu    &lt;NA&gt;         
4 ID_4  reading    library      
5 ID_5  running    &lt;NA&gt;         
6 ID_6  skating    rec center   </code></pre>
<div class="sourceCode" id="cb433"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">right_join</a></span><span class="op">(</span><span class="va">tbl2</span>, <span class="va">tbl1</span>, by <span class="op">=</span> <span class="st">"ID"</span><span class="op">)</span></span></code></pre></div>
<pre><code># A tibble: 6 × 3
  ID    place2        activity1 
  &lt;chr&gt; &lt;chr&gt;         &lt;chr&gt;     
1 ID_2  outside court basketball
2 ID_4  library       reading   
3 ID_6  rec center    skating   
4 ID_1  &lt;NA&gt;          cycling   
5 ID_3  &lt;NA&gt;          kung fu   
6 ID_5  &lt;NA&gt;          running   </code></pre>
<div class="sourceCode" id="cb435"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">right_join</a></span><span class="op">(</span><span class="va">tbl1</span>, <span class="va">tbl2</span>, by <span class="op">=</span> <span class="st">"ID"</span><span class="op">)</span></span></code></pre></div>
<pre><code># A tibble: 4 × 3
  ID    activity1  place2       
  &lt;chr&gt; &lt;chr&gt;      &lt;chr&gt;        
1 ID_2  basketball outside court
2 ID_4  reading    library      
3 ID_6  skating    rec center   
4 ID_8  &lt;NA&gt;       pool         </code></pre>
<div class="sourceCode" id="cb437"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join</a></span><span class="op">(</span><span class="va">tbl1</span>, <span class="va">tbl2</span>, by <span class="op">=</span> <span class="st">"ID"</span><span class="op">)</span></span></code></pre></div>
<pre><code># A tibble: 7 × 3
  ID    activity1  place2       
  &lt;chr&gt; &lt;chr&gt;      &lt;chr&gt;        
1 ID_1  cycling    &lt;NA&gt;         
2 ID_2  basketball outside court
3 ID_3  kung fu    &lt;NA&gt;         
4 ID_4  reading    library      
5 ID_5  running    &lt;NA&gt;         
6 ID_6  skating    rec center   
7 ID_8  &lt;NA&gt;       pool         </code></pre>
<div class="sourceCode" id="cb439"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">tbl1</span>, <span class="va">tbl2</span>, by <span class="op">=</span> <span class="st">"ID"</span><span class="op">)</span></span></code></pre></div>
<pre><code># A tibble: 3 × 3
  ID    activity1  place2       
  &lt;chr&gt; &lt;chr&gt;      &lt;chr&gt;        
1 ID_2  basketball outside court
2 ID_4  reading    library      
3 ID_6  skating    rec center   </code></pre>
<div id="challenge-2-5-minutes-2" class="section level3" number="8.7.1">
<h3>
<span class="header-section-number">8.7.1</span> Challenge 2 (5 minutes)<a class="anchor" aria-label="anchor" href="#challenge-2-5-minutes-2"><i class="fas fa-link"></i></a>
</h3>
<blockquote>
<p>How many flights occurred when the temperature fell below freezing?</p>
<p><strong>Hint:</strong> use the <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> and <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code> functions we learned in the <code>dplyr</code> lesson.</p>
<details><summary>
Solution to challenge 2
</summary><p><br></p>
<div class="sourceCode" id="cb441"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## first, find the days where the temperature fell below 32 F (freezing)</span></span>
<span><span class="va">freezing</span> <span class="op">&lt;-</span> <span class="va">weather</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">month</span>, <span class="va">day</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>mean_temp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">temp</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">mean_temp</span> <span class="op">&lt;</span> <span class="fl">32</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## inner join to get only days with freezing temperature</span></span>
<span><span class="va">flights_mini</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">freezing</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"month"</span>, <span class="st">"day"</span><span class="op">)</span><span class="op">)</span> <span class="co">## number of rows</span></span></code></pre></div>
<pre><code># A tibble: 29,116 × 10
   year month   day dep_delay carrier flight tailnum origin dest  mean_temp
  &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;     &lt;dbl&gt;
1  2013     1     2        43 B6         707 N580JB  JFK    SJU        28.7
2  2013     1     2       156 B6          22 N636JB  JFK    SYR        28.7
3  2013     1     2        -2 US        1030 N162UW  EWR    CLT        28.7
4  2013     1     2        -3 UA        1453 N76515  EWR    IAH        28.7
5  2013     1     2        -5 AA        1141 N621AA  JFK    MIA        28.7
6  2013     1     2         7 UA         407 N493UA  LGA    IAH        28.7
7  2013     1     2        -6 B6         725 N624JB  JFK    BQN        28.7
8  2013     1     2        -6 B6         125 N637JB  JFK    FLL        28.7
9  2013     1     2        -6 B6          49 N658JB  JFK    PBI        28.7
10  2013     1     2        -6 B6         371 N805JB  LGA    FLL        28.7
# … with 29,106 more rows</code></pre>
<div class="sourceCode" id="cb443"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">flights_mini</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">freezing</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">tally</a></span><span class="op">(</span><span class="op">)</span>             <span class="co">## or, get the number</span></span></code></pre></div>
<pre><code>Joining, by = c("month", "day")</code></pre>
<pre><code># A tibble: 1 × 1
     n
 &lt;int&gt;
1 29116</code></pre>
</details>
</blockquote>
</div>
</div>
<div id="filtering-joins" class="section level2" number="8.8">
<h2>
<span class="header-section-number">8.8</span> Filtering joins<a class="anchor" aria-label="anchor" href="#filtering-joins"><i class="fas fa-link"></i></a>
</h2>
<p>In Challenge 2, we could have done a semi join instead of an inner join. That is,
we were essentially filtering the ‘flights_mini’ dataset to get only those flights
that occurred on days where the average temperature was below 32F. We didn’t
do anything with the actual temperature other than drop observations; therefore,
we didn’t actually need the ‘mean_temp’ variable.</p>
<div class="sourceCode" id="cb446"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">flights_mini</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">semi_join</a></span><span class="op">(</span><span class="va">freezing</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"month"</span>, <span class="st">"day"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code># A tibble: 29,116 × 9
    year month   day dep_delay carrier flight tailnum origin dest 
   &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;
 1  2013     1     2        43 B6         707 N580JB  JFK    SJU  
 2  2013     1     2       156 B6          22 N636JB  JFK    SYR  
 3  2013     1     2        -2 US        1030 N162UW  EWR    CLT  
 4  2013     1     2        -3 UA        1453 N76515  EWR    IAH  
 5  2013     1     2        -5 AA        1141 N621AA  JFK    MIA  
 6  2013     1     2         7 UA         407 N493UA  LGA    IAH  
 7  2013     1     2        -6 B6         725 N624JB  JFK    BQN  
 8  2013     1     2        -6 B6         125 N637JB  JFK    FLL  
 9  2013     1     2        -6 B6          49 N658JB  JFK    PBI  
10  2013     1     2        -6 B6         371 N805JB  LGA    FLL  
# … with 29,106 more rows</code></pre>
<p>That is what happens with <strong>filtering joins</strong>: observations from one table are
filtered based on whether or not they match an observation in the other table,
but no information is brought in from the other table. Specifically, <strong>semi joins</strong>
return all rows in x with a match in y, while <strong>anti joins</strong> return all rows in x
without a match in y. Note, that the syntax for filtering joins is the same:
<code>xxx_join(x, y, by = "key_variable")</code>.</p>
</div>
<div id="other-great-resources-2" class="section level2" number="8.9">
<h2>
<span class="header-section-number">8.9</span> Other great resources<a class="anchor" aria-label="anchor" href="#other-great-resources-2"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li><a href="https://hollyemblem.medium.com/joining-data-with-dplyr-in-r-874698eb8898">Holly Emblem blog on Joins</a></li>
<li><a href="https://cran.r-project.org/web/packages/dplyr/vignettes/two-table.html">Two-Table Verbs</a></li>
<li><a href="https://nycflights13.tidyverse.org/">nycflights13 Datasets</a></li>
</ul>
</div>
</div>




  <div class="chapter-nav">
<div class="prev"><a href="create-tidy-data-with-tidyr.html"><span class="header-section-number">7</span> Create Tidy Data with tidyr</a></div>
<div class="next"><a href="subsetting-data-frames.html"><span class="header-section-number">9</span> Subsetting Data Frames</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#joining-related-data"><span class="header-section-number">8</span> Joining Related Data</a></li>
<li><a class="nav-link" href="#introducing-relational-data"><span class="header-section-number">8.1</span> Introducing Relational Data</a></li>
<li><a class="nav-link" href="#types-of-joins-with-dplyr"><span class="header-section-number">8.2</span> Types of joins with dplyr</a></li>
<li><a class="nav-link" href="#introducing-the-nycflights13-data"><span class="header-section-number">8.3</span> Introducing the nycflights13 data</a></li>
<li>
<a class="nav-link" href="#getting-started-2"><span class="header-section-number">8.4</span> Getting started</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#data-analysis-questions"><span class="header-section-number">8.4.1</span> Data analysis questions</a></li></ul>
</li>
<li>
<a class="nav-link" href="#using-left_join"><span class="header-section-number">8.5</span> Using left_join()</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#challenge-1-2-minutes"><span class="header-section-number">8.5.1</span> Challenge 1 (2 minutes)</a></li></ul>
</li>
<li>
<a class="nav-link" href="#modifying-the-by-argument"><span class="header-section-number">8.6</span> Modifying the by argument</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#excluding-the-by-argument"><span class="header-section-number">8.6.1</span> Excluding the by argument</a></li>
<li><a class="nav-link" href="#joining-on-multiple-keys"><span class="header-section-number">8.6.2</span> Joining on multiple keys</a></li>
<li><a class="nav-link" href="#key-variables-with-different-names"><span class="header-section-number">8.6.3</span> Key variables with different names</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#other-mutating-joins"><span class="header-section-number">8.7</span> Other mutating joins</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#challenge-2-5-minutes-2"><span class="header-section-number">8.7.1</span> Challenge 2 (5 minutes)</a></li></ul>
</li>
<li><a class="nav-link" href="#filtering-joins"><span class="header-section-number">8.8</span> Filtering joins</a></li>
<li><a class="nav-link" href="#other-great-resources-2"><span class="header-section-number">8.9</span> Other great resources</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/bcgov/ds-intro-to-r-2-day/blob/master/08-joins.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/bcgov/ds-intro-to-r-2-day/edit/master/08-joins.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Micro-Analysis</strong>" was written by . It was last built on 2023-01-21.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>

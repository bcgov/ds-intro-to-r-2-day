<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 10 Introduction to the bcdata package | BC Migration Patterns</title>
<meta name="description" content="The British Columbia government hosts over 2000 tabular and geospatial data sets in the B.C. Data Catalogue. Most data is available through the B.C. Data Catalogue under an open licence. The...">
<meta name="generator" content="bookdown 0.32 with bs4_book()">
<meta property="og:title" content="Chapter 10 Introduction to the bcdata package | BC Migration Patterns">
<meta property="og:type" content="book">
<meta property="og:url" content="https://bcgov.github.io/ds-intro-to-r-2-day/introduction-to-the-bcdata-package.html">
<meta property="og:description" content="The British Columbia government hosts over 2000 tabular and geospatial data sets in the B.C. Data Catalogue. Most data is available through the B.C. Data Catalogue under an open licence. The...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 10 Introduction to the bcdata package | BC Migration Patterns">
<meta name="twitter:description" content="The British Columbia government hosts over 2000 tabular and geospatial data sets in the B.C. Data Catalogue. Most data is available through the B.C. Data Catalogue under an open licence. The...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.2/transition.js"></script><script src="libs/bs3compat-0.4.2/tabs.js"></script><script src="libs/bs3compat-0.4.2/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="bs4_style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">BC Migration Patterns</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Preface</a></li>
<li class="book-part">Fundamentals</li>
<li><a class="" href="introduction-to-r-and-rstudio.html"><span class="header-section-number">1</span> Introduction to R and RStudio</a></li>
<li><a class="" href="seeking-help-in-r.html"><span class="header-section-number">2</span> Seeking Help in R</a></li>
<li><a class="" href="project-management-with-rstudio.html"><span class="header-section-number">3</span> Project Management With RStudio</a></li>
<li><a class="" href="data-structures.html"><span class="header-section-number">4</span> Data Structures</a></li>
<li><a class="" href="manipulating-data-frames-with-dplyr.html"><span class="header-section-number">5</span> Manipulating Data Frames with dplyr</a></li>
<li><a class="" href="creating-publication-quality-graphics-with-ggplot2.html"><span class="header-section-number">6</span> Creating Publication-Quality Graphics with ggplot2</a></li>
<li><a class="" href="create-tidy-data-with-tidyr.html"><span class="header-section-number">7</span> Create Tidy Data with tidyr</a></li>
<li><a class="" href="joining-related-data.html"><span class="header-section-number">8</span> Joining Related Data</a></li>
<li class="book-part">Beyond the Fundamentals</li>
<li><a class="" href="subsetting-data-frames.html"><span class="header-section-number">9</span> Subsetting Data Frames</a></li>
<li><a class="active" href="introduction-to-the-bcdata-package.html"><span class="header-section-number">10</span> Introduction to the bcdata package</a></li>
<li><a class="" href="data-analysis-reports.html"><span class="header-section-number">11</span> Data analysis reports</a></li>
<li><a class="" href="applications-of-r-markdown.html"><span class="header-section-number">12</span> Applications of R Markdown</a></li>
<li><a class="" href="seeking-help-from-others-with-reprex.html"><span class="header-section-number">13</span> Seeking Help from Others with reprex</a></li>
<li class="book-part">Examples and Extra Practice</li>
<li><a class="" href="bc-migration-patterns.html">BC Migration Patterns</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/bcgov/ds-intro-to-r-2-day">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="introduction-to-the-bcdata-package" class="section level1" number="10">
<h1>
<span class="header-section-number">10</span> Introduction to the bcdata package<a class="anchor" aria-label="anchor" href="#introduction-to-the-bcdata-package"><i class="fas fa-link"></i></a>
</h1>
<p>The British Columbia government hosts over 2000 tabular and geospatial data sets
in the B.C. Data Catalogue. Most data is available through the B.C. Data
Catalogue under an open licence. The <code>bcdata</code> package provides programming
interfaces the B.C. Data Catalogue. This allows R users to search, download and
import metadata and data from the B.C. Data Catalogue into their R session.
Through this functionality the <code>bcdata</code> package connects British Columbia
government public data holdings in the B.C. Data Catalogue with the vast
capabilities of R.</p>
<div id="getting-started-3" class="section level2" number="10.1">
<h2>
<span class="header-section-number">10.1</span> Getting started<a class="anchor" aria-label="anchor" href="#getting-started-3"><i class="fas fa-link"></i></a>
</h2>
<p>First we need to install the <code>bcdata</code> package:</p>
<div class="sourceCode" id="cb484"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"bcdata"</span><span class="op">)</span></span></code></pre></div>
<p>And next we need to load the <code>bcdata</code> package, along with <code>dplyr</code> and <code>ggplot2</code> which we installed and used in earlier lessons:</p>
<div class="sourceCode" id="cb485"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://bcgov.github.io/bcdata/">bcdata</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div id="searching-the-b.c.-data-catalogue" class="section level2" number="10.2">
<h2>
<span class="header-section-number">10.2</span> Searching the B.C. Data Catalogue<a class="anchor" aria-label="anchor" href="#searching-the-b.c.-data-catalogue"><i class="fas fa-link"></i></a>
</h2>
<p>Let’s use the <code>bcdata</code> package to search the B.C. Data Catalogue for some data on <em><strong>public libraries</strong></em> in British Columbia:</p>
<div class="sourceCode" id="cb486"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://bcgov.github.io/bcdata/reference/bcdc_search.html">bcdc_search</a></span><span class="op">(</span><span class="st">"public libraries"</span>, n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<pre><code>Found 18 matches. Returning the first 5.
To see them all, rerun the search and set the 'n' argument to 18.</code></pre>
<pre><code>List of B.C. Data Catalogue Records
Number of records: 5
Titles:
1: BC Public Libraries Statistics 2002-Present (xls, xlsx, csv)
 ID: d03007d6-d6c7-44d7-b2f8-710ba9433617
 Name: bc-public-libraries-statistics-2002-present
2: BC Public Libraries Systems - Branches and Locations (multiple, csv,
 xlsx, kml, wms)
 ID: 3d2318d4-8f5d-4208-88f5-995420d7c58f
 Name: bc-public-libraries-systems-branches-and-locations
3: BC Web Map Library (kml, wms)
 ID: 6164a2af-d3ac-4e92-8dbe-51a93bb5e24b
 Name: bc-web-map-library
4: Environmental Protection Information Resources e-Library (other)
 ID: dae0f2c3-b4f4-4d16-a96d-d7fe7c1581f3
 Name: environmental-protection-information-resources-e-library
5: Biodiversity/Environmental Information Resources e-Library (html)
 ID: a77d4986-91a1-42fc-8e5c-51a304c7975e
 Name: biodiversity-environmental-information-resources-e-library

Access a single record by calling `bcdc_get_record(ID)` with the ID
 from the desired record.</code></pre>
<p>There are many catalogue records with data relating to libraries. Let’s examine the first returned record more closely:</p>
<div class="sourceCode" id="cb489"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://bcgov.github.io/bcdata/reference/bcdc_get_record.html">bcdc_get_record</a></span><span class="op">(</span><span class="st">"bc-public-libraries-systems-branches-and-locations"</span><span class="op">)</span></span></code></pre></div>
<pre><code>Warning: It is advised to use the permanent id ('3d2318d4-8f5d-4208-88f5-995420d7c58f') rather than the name of the record ('bc-public-libraries-systems-branches-and-locations') to guard against future name changes.</code></pre>
<pre><code>B.C. Data Catalogue Record: BC Public Libraries Systems - Branches and
 Locations
Name: bc-public-libraries-systems-branches-and-locations (ID:
 3d2318d4-8f5d-4208-88f5-995420d7c58f)
Permalink:
 https://catalogue.data.gov.bc.ca/dataset/3d2318d4-8f5d-4208-88f5-995420d7c58f
Licence: Open Government Licence - British Columbia
Description: This dataset includes contact and location data for all
 library service points in BC. It also includes some primary data on
 library use and services from the most current year that data is
 available. 
 The dataset is geolocational, and is available in XLSX,
 CSV, and KML formats.
Available Resources (5):
 1. BC Public Library Service Points (csv)
 2. 2018 BC Public Library Systems - Locations and Branch Data (XLS) - v19 (xlsx)
 3. 2018 BC Public Library Systems - Locations and Branch Data (CSV) - v19 (csv)
 4. 2015 BC Public Library Systems - Locations and Branch Data 1.2 (KML) (kml)
 5. WMS getCapabilities request (wms)
Access the full 'Resources' data frame using:
 bcdc_tidy_resources('3d2318d4-8f5d-4208-88f5-995420d7c58f')
Query and filter this data using:
 bcdc_query_geodata('3d2318d4-8f5d-4208-88f5-995420d7c58f')</code></pre>
</div>
<div id="importing-data-from-the-b.c.-data-catalogue" class="section level2" number="10.3">
<h2>
<span class="header-section-number">10.3</span> Importing data from the B.C. Data Catalogue<a class="anchor" aria-label="anchor" href="#importing-data-from-the-b.c.-data-catalogue"><i class="fas fa-link"></i></a>
</h2>
<p>Next, we can use the <code><a href="https://bcgov.github.io/bcdata/reference/bcdc_get_data.html">bcdc_get_data()</a></code> function to import this data directly into R:</p>
<div class="sourceCode" id="cb492"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://bcgov.github.io/bcdata/reference/bcdc_get_data.html">bcdc_get_data</a></span><span class="op">(</span>record <span class="op">=</span> <span class="st">"bc-public-libraries-systems-branches-and-locations"</span><span class="op">)</span></span></code></pre></div>
<p>The <em>bc-public-libraries-systems-branches-and-locations</em> catalogue record
contains multiple data resources or files. If we run the above code
interactively, R will prompt you in the console to select one of the available
resources, as it does not know which one you want to download. The full code to
import the resource from the record—using the record’s permanent id to
guard against future name changes—is provided to the user for next time:</p>
<div class="sourceCode" id="cb493"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lib_raw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://bcgov.github.io/bcdata/reference/bcdc_get_data.html">bcdc_get_data</a></span><span class="op">(</span>record <span class="op">=</span> <span class="st">'3d2318d4-8f5d-4208-88f5-995420d7c58f'</span>,</span>
<span>                         resource <span class="op">=</span> <span class="st">'ed17f111-fb39-46b3-89aa-5375592fbb01'</span><span class="op">)</span></span></code></pre></div>
<pre><code>Reading the data using the read_xlsx function from the readxl package.</code></pre>
<div id="challenge-1-5-minutes-5" class="section level3" number="10.3.1">
<h3>
<span class="header-section-number">10.3.1</span> Challenge 1 (5 minutes)<a class="anchor" aria-label="anchor" href="#challenge-1-5-minutes-5"><i class="fas fa-link"></i></a>
</h3>
<blockquote>
<p>Take a few minutes to search the B.C. Data Catalogue for data sets for a different topic. Identify and import one tabular data set into your R session (e.g. a CSV or XLS resource). Entering <code><a href="https://bcgov.github.io/bcdata/reference/bcdc_browse.html">bcdc_browse()</a></code> into the R console will open the catalogue page in your default web browser.</p>
</blockquote>
</div>
</div>
<div id="practice-manipulating-data-with-dplyr" class="section level2" number="10.4">
<h2>
<span class="header-section-number">10.4</span> Practice manipulating data with <code>dplyr</code><a class="anchor" aria-label="anchor" href="#practice-manipulating-data-with-dplyr"><i class="fas fa-link"></i></a>
</h2>
<p>Let’s return to the libraries data frame <code>lib_raw</code> we imported. As we learned
earlier in the workshop, a useful first step is to get familiar with the data:</p>
<div class="sourceCode" id="cb495"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">lib_raw</span><span class="op">)</span></span></code></pre></div>
<pre><code>tibble [253 × 38] (S3: tbl_df/tbl/data.frame)
 $ Library System                                               : chr [1:253] "Alert Bay Public Library &amp; Museum" "Beaver Valley Public Library" "Bowen Island Public Library" "Burnaby Public Library" ...
 $ Location                                                     : chr [1:253] "Alert Bay Public Library &amp; Museum" "Beaver Valley Public Library" "Bowen Island Public Library" "Bob Prittie Metrotown Branch" ...
 $ 1x Branch Unique ID                                          : chr [1:253] "BABM001" "BFBV001" "BBI001" "BB001" ...
 $ School District Served                                       : chr [1:253] "85" "20" "45" "41" ...
 $ Phone                                                        : chr [1:253] "(250) 974-5721" "(250) 367-7114" "(604) 947-9788" "(604) 436-5427" ...
 $ Physical Address                                             : chr [1:253] "116 Fir Street" "1847 - 1st Street" "430 Bowen Island Trunk" "6100 Willingdon Avenue" ...
 $ City                                                         : chr [1:253] "Alert Bay" "Fruitvale" "Bowen Island" "Burnaby" ...
 $ Province                                                     : chr [1:253] "BC" "BC" "BC" "BC" ...
 $ Postal Code                                                  : chr [1:253] "V0N 1A0" "V0G 1L0" "V0N 1G0" "V5H 4N5" ...
 $ Latitude                                                     : num [1:253] 50.6 49.1 49.4 49.2 49.3 ...
 $ Longitude                                                    : num [1:253] -127 -118 -123 -123 -123 ...
 $ 460x Total branch physical materials, volumes held           : num [1:253] 9361 25477 15100 373232 59958 ...
 $ 556x Branch circulation of print and other physical materials: num [1:253] 2460 19792 36155 1139184 454254 ...
 $ 565x Branch circulation of children's materials              : chr [1:253] "193" "4737" "15964" "476345" ...
 $ 610x Branch reference transactions                           : chr [1:253] "1700" "10000" "8217" "107784" ...
 $ 775x In person visits to this branch or service point        : chr [1:253] "3522" "14750" "52690" "749695" ...
 $ 680x Branch in-library adult programs                        : chr [1:253] "0" "8" "499" "58" ...
 $ 682x Branch outreach adult programs                          : chr [1:253] "1" "2" "0" "101" ...
 $ 690x Attendance at adult programs                            : chr [1:253] "22" "202" "1381" "3865" ...
 $ 700x Branch in-library children's programs                   : chr [1:253] "0" "100" "94" "402" ...
 $ 702x Branch outreach children's programs                     : chr [1:253] "3" "10" "5" "39" ...
 $ 710x Attendance at children's programs                       : chr [1:253] "235" "1208" "1224" "19522" ...
 $ 715x Branch in-library young adult programs                  : chr [1:253] "0" "0" "0" "12" ...
 $ 717x Branch outreach young adult programs                    : chr [1:253] "0" "0" "0" "84" ...
 $ 716x Attendance at young adult programs                      : chr [1:253] "0" "0" "0" "2923" ...
 $ 671x Branch in-library newcomer/ELL programs, all ages       : chr [1:253] "0" "0" "0" "26" ...
 $ 673x Branch outreach newcomer/ELL programs, all ages         : chr [1:253] "0" "0" "0" "0" ...
 $ 672x Attendance at branch newcomer/ELL programs              : chr [1:253] "0" "0" "0" "528" ...
 $ 740x Professional Librarians, hours worked at this branch    : chr [1:253] "0" "0" "1820" "42224" ...
 $ 742x Library Technicians, hours worked at this branch        : chr [1:253] "0" "0" "0" "1733" ...
 $ 752x Community Librarians, hours worked at this branch       : chr [1:253] "622" "4940" "0" NA ...
 $ 770x Other Staff, hours worked at this branch                : chr [1:253] "281" "1350" "4107" "104199" ...
 $ 975x Number of photocopiers in library branch                : num [1:253] 1 1 1 4 1 1 1 2 1 1 ...
 $ 852x Is this location LEED certified?                        : chr [1:253] NA "No" "No" "No" ...
 $ 854x Is this location a Shared Space facility?               : chr [1:253] NA "No" "Yes" "No" ...
 $ 860x Branch space/size, total square metres                  : num [1:253] 213 270 407 5673 465 ...
 $ 890x Hours open per year at this location                    : chr [1:253] "618" "2320" "1953" "3612" ...
 $ 920x Days open per year at this location                     : chr [1:253] "191" "321" "303" "339" ...</code></pre>
<div class="sourceCode" id="cb497"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">lib_raw</span><span class="op">)</span></span></code></pre></div>
<pre><code> [1] "Library System"                                               
 [2] "Location"                                                     
 [3] "1x Branch Unique ID"                                          
 [4] "School District Served"                                       
 [5] "Phone"                                                        
 [6] "Physical Address"                                             
 [7] "City"                                                         
 [8] "Province"                                                     
 [9] "Postal Code"                                                  
[10] "Latitude"                                                     
[11] "Longitude"                                                    
[12] "460x Total branch physical materials, volumes held"           
[13] "556x Branch circulation of print and other physical materials"
[14] "565x Branch circulation of children's materials"              
[15] "610x Branch reference transactions"                           
[16] "775x In person visits to this branch or service point"        
[17] "680x Branch in-library adult programs"                        
[18] "682x Branch outreach adult programs"                          
[19] "690x Attendance at adult programs"                            
[20] "700x Branch in-library children's programs"                   
[21] "702x Branch outreach children's programs"                     
[22] "710x Attendance at children's programs"                       
[23] "715x Branch in-library young adult programs"                  
[24] "717x Branch outreach young adult programs"                    
[25] "716x Attendance at young adult programs"                      
[26] "671x Branch in-library newcomer/ELL programs, all ages"       
[27] "673x Branch outreach newcomer/ELL programs, all ages"         
[28] "672x Attendance at branch newcomer/ELL programs"              
[29] "740x Professional Librarians, hours worked at this branch"    
[30] "742x Library Technicians, hours worked at this branch"        
[31] "752x Community Librarians, hours worked at this branch"       
[32] "770x Other Staff, hours worked at this branch"                
[33] "975x Number of photocopiers in library branch"                
[34] "852x Is this location LEED certified?"                        
[35] "854x Is this location a Shared Space facility?"               
[36] "860x Branch space/size, total square metres"                  
[37] "890x Hours open per year at this location"                    
[38] "920x Days open per year at this location"                     </code></pre>
<p>Let’s tidy up this data frame and find out how many books—physical
materials or volumes—are available between <em>51 and 53 degrees Latitude</em>. Remember
that we previously used <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> to return only columns that we wanted. Here we
are <em>also</em> using <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> to rename <code>460x Total branch physical materials, volumes held</code>
to <code>num_books</code>:</p>
<div class="sourceCode" id="cb499"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">lib_tidy</span> <span class="op">&lt;-</span> <span class="va">lib_raw</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Latitude</span> <span class="op">&lt;=</span> <span class="fl">53</span>, <span class="va">Latitude</span> <span class="op">&gt;=</span> <span class="fl">51</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">`Library System`</span>, <span class="va">Location</span>, <span class="va">City</span>, num_books <span class="op">=</span> <span class="va">`460x Total branch physical materials, volumes held`</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">sum_books</span> <span class="op">&lt;-</span> <span class="va">lib_tidy</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">City</span>, <span class="va">`Library System`</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>total_books <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">num_books</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>`summarise()` has grouped output by 'City'. You can override using the
`.groups` argument.</code></pre>
<div id="challenge-2-10-minutes-3" class="section level3" number="10.4.1">
<h3>
<span class="header-section-number">10.4.1</span> Challenge 2 (10 minutes)<a class="anchor" aria-label="anchor" href="#challenge-2-10-minutes-3"><i class="fas fa-link"></i></a>
</h3>
<blockquote>
<p>Using <code>dplyr</code>, determine the total number of books within each Library System between 51 and 53 degrees latitude in British Columbia.</p>
<details><summary>
Solution to challenge 2
</summary><p><br></p>
<div class="sourceCode" id="cb501"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sum_books</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">`Library System`</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>totals <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">total_books</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code># A tibble: 5 × 2
 `Library System`                         totals
 &lt;chr&gt;                                     &lt;dbl&gt;
1 Cariboo Regional District Library System 245906
2 Okanagan Regional Library District         2350
3 Thompson Nicola Regional Library          49871
4 Valemount Public Library                   6994
5 Vancouver Island Regional Library           879</code></pre>
</details>
</blockquote>
</div>
</div>
<div id="practice-plotting-data-with-ggplot2" class="section level2" number="10.5">
<h2>
<span class="header-section-number">10.5</span> Practice plotting data with <code>ggplot2</code><a class="anchor" aria-label="anchor" href="#practice-plotting-data-with-ggplot2"><i class="fas fa-link"></i></a>
</h2>
<p>Now that we have imported, tidied, and summarized our library data, let’s make a static data visualization to share and communicate the results with others.</p>
<div class="sourceCode" id="cb503"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">sum_books</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">total_books</span>, y <span class="op">=</span> <span class="va">City</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="fig/rmd-09-unnamed-chunk-11-1.png" width="576" style="display: block; margin: auto;"></div>
<div id="challenge-3-10-minutes-2" class="section level3" number="10.5.1">
<h3>
<span class="header-section-number">10.5.1</span> Challenge 3 (10 minutes)<a class="anchor" aria-label="anchor" href="#challenge-3-10-minutes-2"><i class="fas fa-link"></i></a>
</h3>
<blockquote>
<p>Iterate the above plot to include information on the number of books by Library Service. Add a title to the plot. Try other design changes to make the plot more readable.</p>
<details><summary>
Solution to challenge 3
</summary><p><br></p>
<div class="sourceCode" id="cb504"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">sum_books</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">total_books</span>, y <span class="op">=</span> <span class="va">City</span>, fill <span class="op">=</span> <span class="va">`Library System`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>      y <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>      title <span class="op">=</span> <span class="st">"Total Number of Books by City &amp; Library System in B.C."</span>,</span>
<span>      caption <span class="op">=</span> <span class="st">"Data sourced from the B.C. Data Catalogue"</span><span class="op">)</span></span></code></pre></div>
<img src="fig/rmd-09-unnamed-chunk-12-1.png" width="576" style="display: block; margin: auto;"></details>
</blockquote>
</div>
</div>
<div id="importing-data-from-the-b.c.-data-catalogue---another-example" class="section level2" number="10.6">
<h2>
<span class="header-section-number">10.6</span> Importing data from the B.C. Data Catalogue - Another Example<a class="anchor" aria-label="anchor" href="#importing-data-from-the-b.c.-data-catalogue---another-example"><i class="fas fa-link"></i></a>
</h2>
<p>Let’s try another example with <code>bcdata</code>. This time we are going to try importing
some data that is a bit messier. We are going to work with <a href="https://catalogue.data.gov.bc.ca/dataset/87f26989-ccde-407e-a500-5f0c304c460d"><em>New Apprenticeship
Registrations by Fiscal Year and
Gender</em></a>
data. This example will require you to reference elements you’ve learned
throughout the workshop.</p>
<p>You can view the data record we are going to be working with in your browser by
running the following command:</p>
<div class="sourceCode" id="cb505"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://bcgov.github.io/bcdata/reference/bcdc_browse.html">bcdc_browse</a></span><span class="op">(</span><span class="st">"new-apprenticeship-registrations-by-fiscal-year-and-gender"</span><span class="op">)</span></span></code></pre></div>
<p>As we’ve previously learned we can use <code><a href="https://bcgov.github.io/bcdata/reference/bcdc_get_data.html">bcdc_get_data()</a></code> to load data from the B.C. Data Catalogue directly into R. Let’s try that now:</p>
<div class="sourceCode" id="cb506"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">new_reg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://bcgov.github.io/bcdata/reference/bcdc_get_data.html">bcdc_get_data</a></span><span class="op">(</span>record <span class="op">=</span> <span class="st">"new-apprenticeship-registrations-by-fiscal-year-and-gender"</span><span class="op">)</span></span></code></pre></div>
<pre><code>Reading the data using the read_csv function from the readr package.</code></pre>
<pre><code>New names:
Rows: 321 Columns: 12
── Column specification
──────────────────────────────────────────────────────── Delimiter: "," chr
(12): Notes:, ...2, ...3, ...4, ...5, ...6, ...7, ...8, ...9, ...10, ......
ℹ Use `spec()` to retrieve the full column specification for this data. ℹ
Specify the column types or set `show_col_types = FALSE` to quiet this message.
• `` -&gt; `...2`
• `` -&gt; `...3`
• `` -&gt; `...4`
• `` -&gt; `...5`
• `` -&gt; `...6`
• `` -&gt; `...7`
• `` -&gt; `...8`
• `` -&gt; `...9`
• `` -&gt; `...10`
• `` -&gt; `...11`
• `` -&gt; `...12`</code></pre>
<div class="sourceCode" id="cb509"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">new_reg</span></span></code></pre></div>
<pre><code># A tibble: 321 × 12
   `Notes:`    ...2  ...3  ...4  ...5  ...6  ...7  ...8  ...9  ...10 ...11 ...12
   &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
 1 "The follo… &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; 
 2 "Gender is… &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; 
 3 "Fiscal Ye… &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; 
 4 "Professio… &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; 
 5 "... Repre… &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; 
 6  &lt;NA&gt;       &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; 
 7 "Data as o… &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; 
 8 "Data Sour… &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; 
 9  &lt;NA&gt;       &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; 
10 "Trade"     Gend… FY20… FY20… FY20… FY20… FY20… FY20… FY20… FY20… FY20… FY20…
# … with 311 more rows</code></pre>
<p>Well this doesn’t look right. We can see near the bottom of our output that
there are the words of <code>Gender</code> and <code>Trade</code> so we know the data is there but we also have this mess of <code>&lt;NA&gt;</code>.
In this scenario it can be helpful to look at the raw data. Navigate back to the
catalogue page you opened earlier and click the <kbd>View</kbd> button. This
will take you to the
<a href="https://catalogue.data.gov.bc.ca/dataset/87f26989-ccde-407e-a500-5f0c304c460d/resource/8f4f1f19-9027-4d0b-a686-d820bccddd16">Resource</a>
page. Click the link under <strong>Resource</strong> and the data will open up in Excel. The
first thing we notice is that the data does not actually start until 10 rows
down. <code><a href="https://bcgov.github.io/bcdata/reference/bcdc_get_data.html">bcdc_get_data()</a></code> use <code><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv()</a></code> to read csv files and that function
conveniently has an argument called <code>skip</code> which allows us to specify the number
of lines to skip before reading the data. We can use it with <code><a href="https://bcgov.github.io/bcdata/reference/bcdc_get_data.html">bcdc_get_data()</a></code>
like this:</p>
<div class="sourceCode" id="cb511"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">new_reg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://bcgov.github.io/bcdata/reference/bcdc_get_data.html">bcdc_get_data</a></span><span class="op">(</span></span>
<span>  record <span class="op">=</span> <span class="st">"new-apprenticeship-registrations-by-fiscal-year-and-gender"</span>, </span>
<span>  skip <span class="op">=</span> <span class="fl">10</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<pre><code>Reading the data using the read_csv function from the readr package.</code></pre>
<pre><code>Rows: 311 Columns: 12
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (12): Trade, Gender, FY2012/13, FY2013/14, FY2014/15, FY2015/16, FY2016/...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb514"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">new_reg</span></span></code></pre></div>
<pre><code># A tibble: 311 × 12
   Trade  Gender FY201…¹ FY201…² FY201…³ FY201…⁴ FY201…⁵ FY201…⁶ FY201…⁷ FY201…⁸
   &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;  
 1 Aircr… Woman  8       7       9       6       ...     ...     ...     12     
 2 Aircr… Man    108     73      61      46      ...     ...     ...     63     
 3 Aircr… Total… 116     80      70      52      69      48      62      75     
 4 Aircr… Woman  ...     ...     ...     ...     0       ...     ...     ...    
 5 Aircr… Man    ...     ...     ...     ...     ...     ...     ...     ...    
 6 Aircr… Total… 27      40      42      24      ...     23      26      17     
 7 Appli… Woman  0       0       0       ...     ...     ...     0       ...    
 8 Appli… Man    39      ...     36      ...     ...     ...     11      ...    
 9 Appli… Total… 39      ...     36      13      32      13      11      23     
10 Arbor… Woman  ...     0       ...     ...     ...     ...     ...     ...    
# … with 301 more rows, 2 more variables: `FY2020/21` &lt;chr&gt;, `FY2021/22` &lt;chr&gt;,
#   and abbreviated variable names ¹​`FY2012/13`, ²​`FY2013/14`, ³​`FY2014/15`,
#   ⁴​`FY2015/16`, ⁵​`FY2016/17`, ⁶​`FY2017/18`, ⁷​`FY2018/19`, ⁸​`FY2019/20`</code></pre>
<p>Ok this is looking <em>much</em> better. We now have data that is rectangular and looks
more like something we can work with. We do have one more thing to take
care of though. You will notice the data is filled with <code>...</code> values. Those are missing
values in the data. R has a specific way of handling missing values and we need
to tell <code><a href="https://bcgov.github.io/bcdata/reference/bcdc_get_data.html">bcdc_get_data()</a></code> (via <code><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv()</a></code>) that those are missing values. We
do this by adding another argument so that R interprets the <code>...</code> as missing values:</p>
<div class="sourceCode" id="cb516"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">new_reg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://bcgov.github.io/bcdata/reference/bcdc_get_data.html">bcdc_get_data</a></span><span class="op">(</span></span>
<span>  <span class="st">"new-apprenticeship-registrations-by-fiscal-year-and-gender"</span>, </span>
<span>  skip <span class="op">=</span> <span class="fl">10</span>, </span>
<span>  na <span class="op">=</span> <span class="st">"..."</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<pre><code>Reading the data using the read_csv function from the readr package.</code></pre>
<pre><code>Rows: 311 Columns: 12
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr  (2): Trade, Gender
dbl (10): FY2012/13, FY2013/14, FY2014/15, FY2015/16, FY2016/17, FY2017/18, ...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb519"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">new_reg</span></span></code></pre></div>
<pre><code># A tibble: 311 × 12
   Trade  Gender FY201…¹ FY201…² FY201…³ FY201…⁴ FY201…⁵ FY201…⁶ FY201…⁷ FY201…⁸
   &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
 1 Aircr… Woman        8       7       9       6      NA      NA      NA      12
 2 Aircr… Man        108      73      61      46      NA      NA      NA      63
 3 Aircr… Total…     116      80      70      52      69      48      62      75
 4 Aircr… Woman       NA      NA      NA      NA       0      NA      NA      NA
 5 Aircr… Man         NA      NA      NA      NA      NA      NA      NA      NA
 6 Aircr… Total…      27      40      42      24      NA      23      26      17
 7 Appli… Woman        0       0       0      NA      NA      NA       0      NA
 8 Appli… Man         39      NA      36      NA      NA      NA      11      NA
 9 Appli… Total…      39      NA      36      13      32      13      11      23
10 Arbor… Woman       NA       0      NA      NA      NA      NA      NA      NA
# … with 301 more rows, 2 more variables: `FY2020/21` &lt;dbl&gt;, `FY2021/22` &lt;dbl&gt;,
#   and abbreviated variable names ¹​`FY2012/13`, ²​`FY2013/14`, ³​`FY2014/15`,
#   ⁴​`FY2015/16`, ⁵​`FY2016/17`, ⁶​`FY2017/18`, ⁷​`FY2018/19`, ⁸​`FY2019/20`</code></pre>
<p>Now we are ready to work with this data. One thing you might notice is that this
data is in <em>wide</em> format. The number of individuals of a given <code>Gender</code> and
<code>Trade</code> are repeated over time across <em>columns</em> with each column being a fiscal
year. This is great for making a nice table but less great if we want to make a
plot. To reshape the data into long format, we can again make use of
<code>pivot_longer</code> from the <code>tidyr</code> package which we covered in the <a href="create-tidy-data-with-tidyr.html#create-tidy-data-with-tidyr">tidyr section</a>. We only want to pivot the fiscal years
so we need to specify those columns. In addition, we want to give our two new
columns so descriptive names:</p>
<div class="sourceCode" id="cb521"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">new_reg_long</span> <span class="op">&lt;-</span> <span class="va">new_reg</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="va">`FY2012/13`</span><span class="op">:</span><span class="va">`FY2021/22`</span>,</span>
<span>    names_to <span class="op">=</span> <span class="st">"fiscal_year"</span>,</span>
<span>    values_to <span class="op">=</span> <span class="st">"registrations"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">new_reg_long</span></span></code></pre></div>
<pre><code># A tibble: 3,110 × 4
   Trade                           Gender fiscal_year registrations
   &lt;chr&gt;                           &lt;chr&gt;  &lt;chr&gt;               &lt;dbl&gt;
 1 Aircraft Maintenance Technician Woman  FY2012/13               8
 2 Aircraft Maintenance Technician Woman  FY2013/14               7
 3 Aircraft Maintenance Technician Woman  FY2014/15               9
 4 Aircraft Maintenance Technician Woman  FY2015/16               6
 5 Aircraft Maintenance Technician Woman  FY2016/17              NA
 6 Aircraft Maintenance Technician Woman  FY2017/18              NA
 7 Aircraft Maintenance Technician Woman  FY2018/19              NA
 8 Aircraft Maintenance Technician Woman  FY2019/20              12
 9 Aircraft Maintenance Technician Woman  FY2020/21              NA
10 Aircraft Maintenance Technician Woman  FY2021/22               6
# … with 3,100 more rows</code></pre>
<p>There is actually quite a bit of data here while likely represents the number
possible values for <code>Trade</code>. We can check the number of unique values in the
<code>Trade</code> column using a handy function from <code>dplyr</code> called <code><a href="https://dplyr.tidyverse.org/reference/n_distinct.html">n_distinct()</a></code>:</p>
<div class="sourceCode" id="cb523"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html">n_distinct</a></span><span class="op">(</span><span class="va">new_reg_long</span><span class="op">$</span><span class="va">Trade</span><span class="op">)</span></span></code></pre></div>
<pre><code>[1] 104</code></pre>
<p>Sure enough there are 104 of them! Similarly, let’s have a look at what values are in the <code>Gender</code> column using the <code><a href="https://rdrr.io/r/base/unique.html">unique()</a></code> function you learned earlier:</p>
<div class="sourceCode" id="cb525"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">new_reg_long</span><span class="op">$</span><span class="va">Gender</span><span class="op">)</span></span></code></pre></div>
<pre><code>[1] "Woman"                             "Man"                              
[3] "Total (Woman + Man)"               "Non Binary / Prefer not to answer"
[5] "Grand Total"                      </code></pre>
<p>To simplify things let’s take a subset of the Trades in the data and only look at Men and Women:</p>
<div class="sourceCode" id="cb527"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">new_reg_long</span> <span class="op">&lt;-</span> <span class="va">new_reg</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="va">`FY2012/13`</span><span class="op">:</span><span class="va">`FY2021/22`</span>,</span>
<span>    names_to <span class="op">=</span> <span class="st">"fiscal_year"</span>,</span>
<span>    values_to <span class="op">=</span> <span class="st">"registrations"</span>, </span>
<span>    values_drop_na <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">Gender</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Man"</span>, <span class="st">"Woman"</span><span class="op">)</span>,</span>
<span>    <span class="va">Trade</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Boilermaker"</span>, <span class="st">"Climbing Arborist"</span>, <span class="st">"Tilesetter"</span>, <span class="st">"Landscape Horticulturist"</span>, <span class="st">"Baker"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
<p>With this tidied and filtered dataset, we now have something that we can plot
using the skills we’ve learned in the <a href="creating-publication-quality-graphics-with-ggplot2.html#creating-publication-quality-graphics-with-ggplot2">ggplot2 section</a>. One thing to note is that we made
use of the <code>ncol</code> argument in <code><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap()</a></code> so that the faceted plots would
share the x-axis:</p>
<div class="sourceCode" id="cb528"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">new_reg_long</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">fiscal_year</span>, y <span class="op">=</span> <span class="va">registrations</span>, fill <span class="op">=</span> <span class="va">Trade</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html">vars</a></span><span class="op">(</span><span class="va">Gender</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="fig/rmd-09-unnamed-chunk-21-1.png" width="576" style="display: block; margin: auto;"></div>
<p>Try customizing the output with different <code>Trade</code> categories or different ggplot2 customizations. For example what strategies might you take to tidy up the x-axis?</p>
<div id="challenge-4-15-minutes" class="section level3" number="10.6.1">
<h3>
<span class="header-section-number">10.6.1</span> Challenge 4 (15 minutes)<a class="anchor" aria-label="anchor" href="#challenge-4-15-minutes"><i class="fas fa-link"></i></a>
</h3>
<blockquote>
<p>Navigate to the <a href="https://catalogue.data.gov.bc.ca/datasets">BC Data Catalogue</a> and choose a dataset that has a <code>Resource Storage Format</code> that is <code>csv</code> or <code>xlsx</code>. An example of this is the <a href="https://catalogue.data.gov.bc.ca/dataset/bc-seafood-production-2019-2021">BC Seafood Production data</a>. You can use this dataset or one of your choosing. Import your data into R and make a plot, any plot at all. Try to apply the skills you’ve learned in this workshop to make a pretty plot.</p>
<details><summary>
Solution to challenge 4
</summary><p><br></p>
<div class="sourceCode" id="cb529"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">seafood_prod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://bcgov.github.io/bcdata/reference/bcdc_get_data.html">bcdc_get_data</a></span><span class="op">(</span><span class="st">"e591a756-6b99-4986-b8ce-f341bd47228f"</span>,           <span class="st">"a057bfbb-8121-410b-92bb-29f445a6d1a9"</span><span class="op">)</span></span></code></pre></div>
<pre><code>Reading the data using the read_csv function from the readr package.</code></pre>
<pre><code>Rows: 114 Columns: 7
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (3): Species Group, Source, Species/Product
dbl (4): Year, Harvest ('000 t), Landed Value ($ million), Wholesale Value (...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb532"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">seafood_by_year</span> <span class="op">&lt;-</span> <span class="va">seafood_prod</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Year</span> <span class="op">==</span> <span class="fl">2020</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">`Species/Product`</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">`Wholesale Value ($ million)`</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">seafood_by_year</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">`Species/Product`</span>, x <span class="op">=</span> <span class="va">value</span>, fill <span class="op">=</span> <span class="va">`Species/Product`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_d</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/dollar_format.html">dollar</a></span><span class="op">)</span> <span class="op">+</span></span>
<span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"B.C. Seafood Production - 2020"</span>, </span>
<span>      x <span class="op">=</span> <span class="st">"Wholesale Value ($ million)"</span>,</span>
<span>      caption <span class="op">=</span> <span class="st">"https://catalogue.data.gov.bc.ca/dataset/e591a756-6b99-4986-b8ce-f341bd47228f"</span><span class="op">)</span> <span class="op">+</span></span>
<span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<img src="fig/rmd-09-unnamed-chunk-22-1.png" width="576" style="display: block; margin: auto;"></details>
</blockquote>

</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="subsetting-data-frames.html"><span class="header-section-number">9</span> Subsetting Data Frames</a></div>
<div class="next"><a href="data-analysis-reports.html"><span class="header-section-number">11</span> Data analysis reports</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#introduction-to-the-bcdata-package"><span class="header-section-number">10</span> Introduction to the bcdata package</a></li>
<li><a class="nav-link" href="#getting-started-3"><span class="header-section-number">10.1</span> Getting started</a></li>
<li><a class="nav-link" href="#searching-the-b.c.-data-catalogue"><span class="header-section-number">10.2</span> Searching the B.C. Data Catalogue</a></li>
<li>
<a class="nav-link" href="#importing-data-from-the-b.c.-data-catalogue"><span class="header-section-number">10.3</span> Importing data from the B.C. Data Catalogue</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#challenge-1-5-minutes-5"><span class="header-section-number">10.3.1</span> Challenge 1 (5 minutes)</a></li></ul>
</li>
<li>
<a class="nav-link" href="#practice-manipulating-data-with-dplyr"><span class="header-section-number">10.4</span> Practice manipulating data with dplyr</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#challenge-2-10-minutes-3"><span class="header-section-number">10.4.1</span> Challenge 2 (10 minutes)</a></li></ul>
</li>
<li>
<a class="nav-link" href="#practice-plotting-data-with-ggplot2"><span class="header-section-number">10.5</span> Practice plotting data with ggplot2</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#challenge-3-10-minutes-2"><span class="header-section-number">10.5.1</span> Challenge 3 (10 minutes)</a></li></ul>
</li>
<li>
<a class="nav-link" href="#importing-data-from-the-b.c.-data-catalogue---another-example"><span class="header-section-number">10.6</span> Importing data from the B.C. Data Catalogue - Another Example</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#challenge-4-15-minutes"><span class="header-section-number">10.6.1</span> Challenge 4 (15 minutes)</a></li></ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/bcgov/ds-intro-to-r-2-day/blob/master/10-intro-to-bcdata.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/bcgov/ds-intro-to-r-2-day/edit/master/10-intro-to-bcdata.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>BC Migration Patterns</strong>" was written by . It was last built on 2023-01-22.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 12 Applications of R Markdown | Introduction to Data Science using R Workshop</title>
<meta name="description" content="Now that we’ve learned the basics of R and R Markdown, we’re going to tie some things together by doing a regression on the Gapminder data and displaying our results in a nicely formatted...">
<meta name="generator" content="bookdown 0.31 with bs4_book()">
<meta property="og:title" content="Chapter 12 Applications of R Markdown | Introduction to Data Science using R Workshop">
<meta property="og:type" content="book">
<meta property="og:url" content="https://bcgov.github.io/ds-intro-to-r-2-day/applications-of-r-markdown.html">
<meta property="og:description" content="Now that we’ve learned the basics of R and R Markdown, we’re going to tie some things together by doing a regression on the Gapminder data and displaying our results in a nicely formatted...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 12 Applications of R Markdown | Introduction to Data Science using R Workshop">
<meta name="twitter:description" content="Now that we’ve learned the basics of R and R Markdown, we’re going to tie some things together by doing a regression on the Gapminder data and displaying our results in a nicely formatted...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.2/transition.js"></script><script src="libs/bs3compat-0.4.2/tabs.js"></script><script src="libs/bs3compat-0.4.2/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="bs4_style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Introduction to Data Science using R Workshop</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Preface</a></li>
<li><a class="" href="introduction-to-r-and-rstudio.html"><span class="header-section-number">1</span> Introduction to R and RStudio</a></li>
<li><a class="" href="seeking-help-in-r.html"><span class="header-section-number">2</span> Seeking Help in R</a></li>
<li><a class="" href="project-management-with-rstudio.html"><span class="header-section-number">3</span> Project Management With RStudio</a></li>
<li><a class="" href="data-structures.html"><span class="header-section-number">4</span> Data Structures</a></li>
<li><a class="" href="exploring-data-frames.html"><span class="header-section-number">5</span> Exploring Data Frames</a></li>
<li><a class="" href="dataframe-manipulation-with-dplyr.html"><span class="header-section-number">6</span> Dataframe Manipulation with dplyr</a></li>
<li><a class="" href="creating-publication-quality-graphics-with-ggplot2.html"><span class="header-section-number">7</span> Creating Publication-Quality Graphics with ggplot2</a></li>
<li><a class="" href="create-tidy-data-with-tidyr.html"><span class="header-section-number">8</span> Create Tidy Data with tidyr</a></li>
<li><a class="" href="exploring-data-frames-1.html"><span class="header-section-number">9</span> Exploring Data Frames</a></li>
<li><a class="" href="introduction-to-the-bcdata-package.html"><span class="header-section-number">10</span> Introduction to the bcdata package</a></li>
<li><a class="" href="data-analysis-reports.html"><span class="header-section-number">11</span> Data analysis reports</a></li>
<li><a class="active" href="applications-of-r-markdown.html"><span class="header-section-number">12</span> Applications of R Markdown</a></li>
<li><a class="" href="seeking-help-from-others-with-reprex.html"><span class="header-section-number">13</span> Seeking Help from Others with reprex</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/bcgov/ds-intro-to-r-2-day">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="applications-of-r-markdown" class="section level1" number="12">
<h1>
<span class="header-section-number">12</span> Applications of R Markdown<a class="anchor" aria-label="anchor" href="#applications-of-r-markdown"><i class="fas fa-link"></i></a>
</h1>
<p>Now that we’ve learned the basics of R and R Markdown, we’re going to tie some
things together by doing a regression on the Gapminder data and displaying our
results in a nicely formatted document.</p>
<p>Working in a new R Markdown document (File -&gt; New File -&gt; R Markdown Document),
we can load the libraries that we are going to use, and load the data in
a code chunk:</p>
<pre>
```{r load}
library(readr)
library(dplyr)
library(ggplot2)
gapminder 
<p>For now, we are just going to use the data for Canada, so let’s insert a code
chunk to filter our data to just Canada:</p>
<pre>
```{r filter-can}
canada 
<p>We want to do a regression investigating the relationship between life
expectancy and per-capita GDP in Canada.</p>
<p>We can start by inserting another code chunk to do a quick visualization of the
data. We can insert the regression line on the points, but this doesn’t give us
the regression coefficients, significance, etc. that we need to really evaluate
the relationship.</p>
<pre>
```{r plot-1}
ggplot(canada, aes(x = gdpPercap, y = lifeExp)) + 
  geom_point() + 
  geom_smooth(method = "lm")
```
</pre>
<p>We use the <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code> function to perform a General Linear Model (GLM), of which
a regression is one form. It is specified by a new syntax, a “formula” syntax:</p>
<div class="sourceCode" id="cb564"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">response</span> <span class="op">~</span> <span class="fu">predictor</span><span class="op">(</span><span class="va">s</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">data</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
<p>So in our case, we can put in a new code chunk to fit the model:</p>
<pre>
```{r model}
canada_lm 
<p>The <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> function gives us the high level information from our regression
model: The coefficient estimates, the R-squared, and the p-value.</p>
<p>To this point we have been using <em>ggplot2</em> for plotting, but there is also a
built-in <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> function. If we use that function on a model, it gives us
some basic diagnostic plots:</p>
<pre>
```{r diagnostics}
plot(canada_lm)
```
</pre>
<p>But these <code>lm</code> objects are ungainly - they are fine to look at to inspect the
important parts of our model, but difficult to extract those pieces that we
want to use later - such as regression coefficients and P values.</p>
<p>There is another package we can use, called <em>broom</em>, that is used to tidy
model results into a format we are familiar with: a <code>data.frame</code>. <em>broom</em> works
with many different types of models, today we are going to use it on our <code>lm</code>.</p>
<p>You will first need to install the package:</p>
<div class="sourceCode" id="cb565"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"broom"</span><span class="op">)</span></span></code></pre></div>
<p>Then add a chunk that loads the package, and calls the most commonly-used
functions in <em>broom</em>:</p>
<pre>
```{r broom}
library(broom)
model_summary 
</pre></pre></pre></pre>
<ul>
<li>
<code>glance</code> gives us the model-level summary. The r-squared and adjusted r-squared,
the F statistic, the P value, etc.</li>
<li>
<code>tidy</code> gives us the information for each term in the regression - in our
case just the intercept and the estimated effect of per-capita GDP on life expectancy.</li>
<li>
<code>augment</code> gives us the estimated values of the response variable as predicted
by our model.</li>
</ul>
<p>Now that these are in a data frame, we can use them more easily. Let’s plot our
regression line onto our plot:</p>
<pre>
```{r plot-lm}
ggplot() + 
  geom_point(data = canada, aes(x = gdpPercap, y = lifeExp)) + 
  geom_line(data = model_predict, aes(x = gdpPercap, y = .fitted))
```
</pre>
<p>Again, using the data frame containing our predicted values, we can calculate
the 95% confidence limits, and plot them as well:</p>
<pre>
```{r plot-ci, echo=FALSE}
model_predict % 
  mutate(lower_ci = .fitted - 1.96 * .se.fit, 
         upper_ci = .fitted + 1.96 * .se.fit)

ggplot() + 
  geom_ribbon(data = model_predict, aes(x = gdpPercap, ymin = lower_ci, ymax = upper_ci), alpha = 0.2) + 
  geom_point(data = canada, aes(x = gdpPercap, y = lifeExp)) + 
  geom_line(data = model_predict, aes(x = gdpPercap, y = .fitted))
```
</pre>
<p>If we compare this plot to the auto-generated line we added at the beginning of
the lesson (using <code><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth()</a></code>), we see they are the same.</p>
<p>We can also pull out some of those model terms and report on them “reproducibly”:</p>
<p>In our plot:</p>
<pre>
```{r model-stats, echo=FALSE}
r2  0.05")

ggplot() + 
  geom_ribbon(data = model_predict, aes(x = gdpPercap, ymin = lower_ci, ymax = upper_ci), alpha = 0.2) + 
  geom_point(data = canada, aes(x = gdpPercap, y = lifeExp)) + 
  geom_line(data = model_predict, aes(x = gdpPercap, y = .fitted)) + 
  geom_text(aes(x = 72, y = 30000), label = paste0("R^2 = ", r2, "; ", sig_0.05))
```
</pre>
<p>And in text:</p>
<pre>
```{r lifeExp-stats, echo=FALSE}
life_exp 
<p>Then in our document we can type:</p>
<pre><code>The predicted effect of per-capita GDP on life expectancy is `r life_exp_estimate` 
(SE: `r life_exp_se`), meaning that for every dollar increase in per-capita GDP
we live longer by approximately `r life_exp_esimate` years.</code></pre>
<p>This helps reduce typos, copy-paste errors, and ensures that if our data change,
so do our results.</p>
<blockquote>
<h2 id="challenge-1-2">Challenge 1</h2>
<p>Create a copy of your report for Canada, and do it for the country of your choice.</p>
<blockquote>
<h2 id="solution-to-challenge-1">Solution to Challenge 1</h2>
All you really need to do is change
<pre>"Canada"</pre>
in your
<pre>filter</pre>
<p>statement to another country of your choosing.</p>
</blockquote>
</blockquote>
<blockquote>
<h2 id="challenge-2-2">Challenge 2</h2>
<p>Remove or add chunks, and change the chunk options to only show the figures
and results so the rendered report looks like a report you would submit.</p>
<blockquote>
<h2 id="solution-to-challenge-2-1">Solution to Challenge 2</h2>
Possible chunk options to change:
<pre>results='hide'</pre>
<pre>echo=FALSE</pre>
<pre>message=FALSE</pre>
<pre>include=FALSE</pre>
</blockquote>
</blockquote>

</pre>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="data-analysis-reports.html"><span class="header-section-number">11</span> Data analysis reports</a></div>
<div class="next"><a href="seeking-help-from-others-with-reprex.html"><span class="header-section-number">13</span> Seeking Help from Others with reprex</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav"><li><a class="nav-link" href="#applications-of-r-markdown"><span class="header-section-number">12</span> Applications of R Markdown</a></li></ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/bcgov/ds-intro-to-r-2-day/blob/master/11-rmarkdown-application-regression.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/bcgov/ds-intro-to-r-2-day/edit/master/11-rmarkdown-application-regression.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Introduction to Data Science using R Workshop</strong>" was written by . It was last built on 2023-01-04.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
